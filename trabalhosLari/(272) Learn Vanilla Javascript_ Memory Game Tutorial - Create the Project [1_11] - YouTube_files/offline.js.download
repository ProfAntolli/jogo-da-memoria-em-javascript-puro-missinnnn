(function(g){var window=this;'use strict';var b5C=function(v){var O=new g.di("und",new g.sL("Default","und",!0));O.captionTracks=v.captionTracks;return O},o3w=function(v){return new g.x_(function(O,Y){var S=v.length,d=[];
if(S)for(var r=function(V,A){S--;d[V]=A;S==0&&O(d)},b=function(V){Y(V)},z,M=0;M<v.length;M++)z=v[M],g.i9l(z,g.SU(r,M),b);
else O(d)})},BF=function(v){this.Y=v},Z7=function(){BF.apply(this,arguments)},jNv=function(){Z7.apply(this,arguments)},WGY=function(){Z7.apply(this,arguments)},zRY=function(){Z7.apply(this,arguments)},sN0=function(){Z7.apply(this,arguments)},g3U=function(){Z7.apply(this,arguments)},MgN=function(){Z7.apply(this,arguments)},VgN=function(){BF.apply(this,arguments)},AF0=function(){Z7.apply(this,arguments)},f$S=function(){Z7.apply(this,arguments)},$2Y=function(){Z7.apply(this,arguments)},kAS=function(){Z7.apply(this,
arguments)},U2N=function(){Z7.apply(this,arguments)},cF0=function(){Z7.apply(this,arguments)},ugN=function(){Z7.apply(this,arguments)},CNL=function(){Z7.apply(this,arguments)},yF0=function(){Z7.apply(this,arguments)},a$N=function(){Z7.apply(this,arguments)},x2J=function(){Z7.apply(this,arguments)},pdJ=function(){Z7.apply(this,arguments)},TcY=function(){BF.apply(this,arguments)},l$U=function(){Z7.apply(this,arguments)},FGL=function(){Z7.apply(this,arguments)},hRv=function(){Z7.apply(this,arguments)},
RRS=function(){Z7.apply(this,arguments)},eR0=function(){Z7.apply(this,arguments)},E3C=function(){Z7.apply(this,arguments)},QN8=function(){Z7.apply(this,arguments)},LGK=function(){Z7.apply(this,arguments)},BcK=function(){Z7.apply(this,arguments)},Z58=function(){BF.apply(this,arguments)},XdY=function(){BF.apply(this,arguments)},wdK=function(){BF.apply(this,arguments)},I$J=function(){Z7.apply(this,arguments)},qfN=function(){Z7.apply(this,arguments)},n3Y=function(){Z7.apply(this,arguments)},JF0=function(){Z7.apply(this,
arguments)},KGC=function(){Z7.apply(this,arguments)},PNU=function(){Z7.apply(this,arguments)},GAN=function(){Z7.apply(this,arguments)},i5t=function(){Z7.apply(this,arguments)},m2N=function(){Z7.apply(this,arguments)},tgt=function(){Z7.apply(this,arguments)},D20=function(){Z7.apply(this,arguments)},H5L=function(){Z7.apply(this,arguments)},NcN=function(){Z7.apply(this,arguments)},vXv=function(){Z7.apply(this,arguments)},OKC=function(){Z7.apply(this,arguments)},Y6Y=function(){Z7.apply(this,arguments)},
S6U=function(){Z7.apply(this,arguments)},dZK=function(){Z7.apply(this,arguments)},ruN=function(){Z7.apply(this,arguments)},bK0=function(){Z7.apply(this,arguments)},oXt=function(){Z7.apply(this,arguments)},js0=function(){Z7.apply(this,arguments)},WfN=function(){Z7.apply(this,arguments)},zvY=function(){Z7.apply(this,arguments)},ss8=function(){Z7.apply(this,arguments)},gXU=function(){Z7.apply(this,arguments)},M6U=function(){BF.apply(this,arguments)},V6S=function(){Z7.apply(this,arguments)},AuN=function(){Z7.apply(this,
arguments)},f0N=function(){Z7.apply(this,arguments)},$ZN=function(){Z7.apply(this,arguments)},kkJ=function(){Z7.apply(this,arguments)},UZ8=function(){Z7.apply(this,arguments)},cuL=function(){Z7.apply(this,arguments)},uJS=function(){Z7.apply(this,arguments)},CUY=function(){Z7.apply(this,arguments)},yuY=function(){Z7.apply(this,arguments)},a0J=function(){Z7.apply(this,arguments)},xZv=function(){Z7.apply(this,arguments)},pBL=function(){Z7.apply(this,arguments)},Tdv=function(){Z7.apply(this,arguments)},
l0t=function(){Z7.apply(this,arguments)},Ff8=function(){Z7.apply(this,arguments)},hvS=function(){Z7.apply(this,arguments)},Rv0=function(){Z7.apply(this,arguments)},evC=function(){Z7.apply(this,arguments)},EXt=function(){Z7.apply(this,arguments)},QsN=function(){Z7.apply(this,arguments)},LfL=function(){Z7.apply(this,arguments)},BdC=function(){Z7.apply(this,arguments)},ZK0=function(){Z7.apply(this,arguments)},XBJ=function(){Z7.apply(this,arguments)},wBL=function(){Z7.apply(this,arguments)},I0U=function(){Z7.apply(this,
arguments)},q6L=function(){Z7.apply(this,arguments)},nX8=function(){Z7.apply(this,arguments)},JuL=function(){Z7.apply(this,arguments)},KfN=function(){Z7.apply(this,arguments)},PUY=function(){Z7.apply(this,arguments)},GkN=function(v){v=v.key||v.id;
if(!v)throw Error("Entity key is missing");return v},iKU=function(){if(XE)return XE();
var v={};XE=g.vQ("PersistentEntityStoreDb",{hq:(v.EntityStore={SI:1},v.EntityAssociationStore={SI:2},v),shared:!1,upgrade:function(O,Y){Y(1)&&g.LQ(g.FF(O,"EntityStore",{keyPath:"key"}),"entityType","entityType");Y(2)&&(O=g.FF(O,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.LQ(O,"byParentEntityKey","parentEntityKey"),g.LQ(O,"byChildEntityKey","childEntityKey"))},
version:3});return XE()},mZw=function(v){return g.Jk(iKU(),v)},t68=function(v){return g.Jk((0,g.BnY)(),v)},wm=function(v){this.token=v},Ie=function(v,O){O=O===void 0?{}:O;
g.iK.call(this,g.ZdS[v],Object.assign({},{name:"PESEncoderError",type:v},O));this.type=v;this.level="WARNING";Object.setPrototypeOf(this,Ie.prototype)},DZ8=function(v){return new Ie("WRONG_DATA_TYPE",{qy:v})},HKY=function(v){return v instanceof Error?new Ie("UNKNOWN_ENCODE_ERROR",{originalMessage:v.message}):new Ie("UNKNOWN_ENCODE_ERROR")},NdN=function(v){return v instanceof Error?new Ie("UNKNOWN_DECODE_ERROR",{originalMessage:v.message}):new Ie("UNKNOWN_DECODE_ERROR")},v_K=function(v,O){v=v instanceof
Ie?v:O(v);
g.LP(v);throw v;},OZv=function(){},YW8=function(v,O,Y){try{return v.G(O,Y)}catch(S){v_K(S,HKY)}},SWt=function(v){v=(new TextEncoder).encode(v).subarray(0,16);
var O=new Uint8Array(16);O.set(v);return O},qT=function(v){this.Y=v},rdS=function(v){var O=ddN[v];
if(O)return O;g.Br(new g.iK("Entity model not found.",{entityType:v}))},bZJ=function(v,O){this.Y=v;
this.U=O;this.G={}},jwv=function(v,O){a:{v=o_t(v.U,O.version);
try{var Y=v.U(O.data,O.key);break a}catch(S){v_K(S,NdN)}Y=void 0}return Y},nk=function(v,O,Y){return v.Y.objectStore("EntityStore").get(O).then(function(S){if(S){if(Y&&S.entityType!==Y)throw Error("Incorrect entity type");
return jwv(v,S)}})},JH=function(v,O,Y){return Y?(Y=Y.map(function(S){return nk(v,S,O)}),g.az.all(Y)):v.Y.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(O)).then(function(S){return S.map(function(d){return jwv(v,d)})})},PF=function(v,O,Y){var S=GkN(O),d=o_t(v.U,1),r=Object.assign({},O);
return v.Y.objectStore("EntityStore").get(S).then(function(b){if(b){if(b.entityType!==Y)throw Error("Incorrect entity type");r.entityMetadata||(b=jwv(v,b),r.entityMetadata=b.entityMetadata)}}).then(function(){var b={key:S,
entityType:Y,data:YW8(d,r,S),version:1};return g.az.all([g.eN(v.Y.objectStore("EntityStore"),b),Wzw(v,r,Y)])}).then(function(){Kk(v,S,Y);
return S})},zEw=function(v,O,Y){O=O.map(function(S){return PF(v,S,Y)});
return g.az.all(O)},Gl=function(v,O,Y){if(Y==null?0:Y.C3){var S=new Set;
return swN(v,O,S).then(function(){for(var r=[],b=g.y(S),z=b.next();!z.done;z=b.next())r.push(Gl(v,z.value));return g.az.all(r).then(function(){})})}var d=g.We(O).entityType;
return g.az.all([v.Y.objectStore("EntityStore").delete(O),g_t(v,O)]).then(function(){Kk(v,O,d)})},MyL=function(v,O){return g.wJ(v.Y.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(O)},function(Y){return g.az.all([Y.delete(),
g_t(v,Y.cursor.primaryKey)]).then(function(){Kk(v,Y.cursor.primaryKey,O);return g.Z3(Y)})})},VyU=function(v,O,Y,S){var d=o_t(v.U,1);
return nk(v,O,S).then(function(r){if(r){r=g.UX(r,Y);var b={key:O,entityType:S,data:YW8(d,r,O),version:1};return g.az.all([g.eN(v.Y.objectStore("EntityStore"),b),Wzw(v,r,S)])}}).then(function(){Kk(v,O,S);
return O})},Kk=function(v,O,Y){var S=v.G[Y];
S||(S=new Set,v.G[Y]=S);S.add(O)},AdU=function(v,O,Y){var S=GkN(O);
Y=rdS(Y);if(!Y)return g.az.resolve([]);Y=new Y(O);v=v.Y.objectStore("EntityAssociationStore");O=[];Y=g.y(Y.U());for(var d=Y.next();!d.done;d=Y.next())O.push(g.eN(v,{parentEntityKey:S,childEntityKey:d.value}));return g.az.all(O).then(function(r){return r.map(function(b){return b[1]})})},g_t=function(v,O){return v.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(O))},Wzw=function(v,O,Y){var S=GkN(O);
return g_t(v,S).then(function(){return AdU(v,O,Y)})},swN=function(v,O,Y){if(Y.has(O))return g.az.resolve(void 0);
Y.add(O);return f4Y(v,O).then(function(S){return v.Y.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(O)).then(function(){return S})}).then(function(S){var d=g.az.resolve(void 0);
S=g.y(S);for(var r=S.next(),b={};!r.done;b={Ya:void 0},r=S.next())b.Ya=r.value,d=d.then(function(z){return function(){return swN(v,z.Ya,Y)}}(b));
return d}).then(function(){})},f4Y=function(v,O){var Y=v.Y.objectStore("EntityAssociationStore");
return Y.index("byParentEntityKey").getAll(IDBKeyRange.only(O)).then(function(S){var d=[];S=g.y(S);for(var r=S.next();!r.done;r=S.next())r=r.value,d.push(Y.index("byChildEntityKey").getAll(r.childEntityKey));return g.az.all(d)}).then(function(S){var d=[];
S=g.y(S);for(var r=S.next();!r.done;r=S.next())r=r.value,r.length===1&&d.push(r[0].childEntityKey);return d})},iR=function(){},$dY=function(){this.Y={};
this.Y[0]=new iR;if(!g.uF("aes_pes_encoder_killswitch")){var v=this.Y;try{var O=g.mF();var Y=SWt(O);var S=new qT(new g.xl(Y),new g.a9(Y))}catch(d){throw v=d instanceof Error?new Ie("KEY_CREATION_FAILED",{originalMessage:d.message}):new Ie("KEY_CREATION_FAILED"),g.LP(v),v;}v[1]=S}},o_t=function(v,O){O=O===void 0?0:O;
v=v.Y[O];if(!v)throw O=new Ie("INVALID_ENCODER_VERSION",{qy:O}),g.LP(O),O;return v},mi=function(v,O){g.X.call(this);
this.token=v;this.Y=O;this.observers=[];v=new g.Pm.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.mF());v.onmessage=this.U.bind(this);this.channel=v},tH=function(v,O,Y){var S,d,r,b;
return g.B(function(z){if(z.U==1)return g.E(z,mZw(v.token),2);if(z.U!=3)return S=z.Y,g.E(z,g.Rz(S,["EntityStore","EntityAssociationStore"],O,function(M){d=new bZJ(M,v.Y);return Y(d)}),3);
r=z.Y;d&&(b=d.G,Object.keys(b).length>0&&(v.channel.postMessage(b),k7S(v,b)));return z.return(r)})},D7=function(v,O,Y){return tH(v,{mode:"readwrite",
vT:!0},function(S){return PF(S,O,Y)})},Ud8=function(v,O){return tH(v,{mode:"readwrite",
vT:!0},function(Y){return zEw(Y,O,"offlineOrchestrationActionWrapperEntity")})},cdL=function(v,O){return tH(v,{mode:"readwrite",
vT:!0},function(Y){return Gl(Y,O)})},unU=function(v){return tH(v,{mode:"readwrite",
vT:!0},function(O){return MyL(O,"videoPlaybackPositionEntity")})},HF=function(v,O,Y){return tH(v,{mode:"readonly",
vT:!0},function(S){return nk(S,O,Y)})},NT=function(v,O,Y){return tH(v,{mode:"readonly",
vT:!0},function(S){return JH(S,O,Y)})},k7S=function(v,O){v=g.y(v.observers);
for(var Y=v.next();!Y.done;Y=v.next())Y=Y.value,Y(O)},Cdv=function(){var v,O,Y;
return g.B(function(S){if(S.U==1)return g.cm(S,2),g.E(S,g.Hh(),4);if(S.U!=2){v=S.Y;if(!v||!g.ti()||typeof g.Pm.BroadcastChannel==="undefined")return S.return();O=new $dY;return S.return(new mi(v,O))}Y=g.Tc(S);Y instanceof Error&&g.LP(Y);return S.return()})},v9=function(){ydw||(ydw=Cdv());
return ydw},a4v=function(v){var O;
v=(O=v.options)==null?void 0:O.persistenceOption;return v==="ENTITY_PERSISTENCE_OPTION_PERSIST"||v==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},xdt=function(v){var O;
return g.B(function(Y){return Y.U==1?g.E(Y,v9(),2):(O=Y.Y)?g.E(Y,tH(O,"readwrite",function(S){for(var d={},r=g.y(v),b=r.next(),z={};!b.done;z={EQ:void 0,QM:void 0},b=r.next())z.EQ=b.value,z.EQ.entityKey&&a4v(z.EQ)&&(z.QM=g.nC(z.EQ.payload),b=void 0,z.EQ.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(b=function(M){return function(){return PF(S,M.EQ.payload[M.QM],M.QM)}}(z)),z.EQ.type==="ENTITY_MUTATION_TYPE_DELETE"&&(b=function(M){return function(){return Gl(S,M.EQ.entityKey)}}(z)),z.EQ.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(b=function(M){return function(){return VyU(S,M.EQ.entityKey,M.EQ.payload[M.QM],M.QM)}}(z)),b&&(d[z.EQ.entityKey]=d[z.EQ.entityKey]?d[z.EQ.entityKey].then(b):b()));
return g.az.all(Object.values(d))}),0):Y.return()})},ptY=function(v){var O;
return g.B(function(Y){if(Y.U==1){O=v.mutations;if(!O||O.length<=0)return Y.return();if(g.tw){var S={type:"ENTITY_LOADED"};O!==void 0&&(S.payload=O);g.tw.dispatch(S)}return g.E(Y,xdt(O),2)}O.length=0;g.UE(Y)})},T10=function(v){return v!==void 0},l4v=function(v){var O=g.aJ();
O=Object.assign({},O);v=Object.assign({},v);for(var Y in O)v[Y]?(O[Y]!==4&&(O[Y]=v[Y]),delete v[Y]):O[Y]!==2&&(O[Y]=4);Object.assign(O,v);g.Mqg(O);JSON.stringify(O);return O},FzS=function(v){var O,Y;
return g.B(function(S){if(S.U==1)return g.E(S,g.Hh(),2);if(S.U!=3)return(O=S.Y)?g.E(S,g.Tj(O),3):S.return();Y=S.Y;return S.return(g.Rz(Y,["index","media","captions"],{mode:"readwrite",vT:!0},function(d){var r=IDBKeyRange.bound(v+"|",v+"~");d=[d.objectStore("index").delete(r),d.objectStore("media").delete(r),d.objectStore("captions").delete(r)];return g.az.all(d).then(function(){})}))})},hEN=function(){var v,O;
return g.B(function(Y){if(Y.U==1)return g.E(Y,g.Hh(),2);if(Y.U!=3){v=Y.Y;if(!v)throw g.CQ("rvdfd");return g.E(Y,g.Tj(v),3)}O=Y.Y;return Y.return(g.Rz(O,["index","media"],{mode:"readwrite",vT:!0},function(S){var d={};return g.Bh(S.objectStore("index"),{},function(r){var b=r.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),z=g.az.resolve(void 0);if(b){var M=b[1];b=b[2];d[M]=d[M]||{};var V;d[M][b]=g.kE3((V=r.getValue())==null?void 0:V.fmts)}else z=r.delete().then(function(){});
return g.az.all([g.Z3(r),z]).then(function(A){return g.y(A).next().value})}).then(function(){for(var r={},b=g.y(Object.keys(d)),z=b.next();!z.done;z=b.next()){z=z.value;
var M=d[z].v;r[z]=d[z].a&&M?1:2}var V=l4v(r);return g.Fpw(S.objectStore("media"),{},function(A){var f=A.cursor.key.match(g.Crc);f&&r[f[1]]||S.objectStore("media").delete(A.cursor.key);return g.cSQ(A)}).then(function(){return V})})}))})},REY=function(v,O){var Y,S;
return g.B(function(d){if(d.U==1)return g.E(d,g.Hh(),2);if(d.U!=3){Y=d.Y;if(!Y)throw g.CQ("wct");return g.E(d,g.Tj(Y),3)}S=d.Y;return g.E(d,g.Rz(S,["captions"],{mode:"readwrite",vT:!0},function(r){var b=[];r=r.objectStore("captions");for(var z=0;z<O.length;z++){var M=g.eN(r,O[z],v+"|"+O[z].metadata.vss_id);b.push(M)}return g.az.all(b)}),0)})},eEN=function(v){var O,Y,S;
return g.B(function(d){if(d.U==1)return O=IDBKeyRange.bound(v+"|",v+"~"),g.E(d,g.Hh(),2);if(d.U!=3){Y=d.Y;if(!Y)throw g.CQ("gactfv");return g.E(d,g.Tj(Y),3)}S=d.Y;return d.return(S.getAll("captions",O))})},E_U=function(v){return g.B(function(O){g.pm(v,0);
return O.return(FzS(v))})},QwN=function(v){return{context:g.O4(),
videoIds:v}},LzN=function(v){return{context:g.O4(),
playlistIds:v}},B1Y=function(v){return{context:g.O4(),
offlinePlaylistSyncChecks:v}},ZZS=function(){this.Y=new Map},wtw=function(){XtU||(XtU=new ZZS);
return XtU},I4N=function(v,O){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:v},metadata:O,statusCode:void 0,csn:void 0,can:void 0}},qWU=function(v,O,Y){if(!Y){var S=S===void 0?!1:S;
Y=v.Y.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!Y||S)Y=g.a7(16),v.Y.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",Y)}v={flowNonce:Y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:O.eventType};O.metadata&&(v.flowMetadata=O.metadata);O.statusCode!==void 0&&(v.flowEventStatus=O.statusCode);O.csn&&(v.csn=O.csn);O.can&&(v.can=O.can);g.z2("flowEvent",v,void 0)},n_v=function(v){var O,Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p,oi,P0,uh;
return g.B(function(lL){if(lL.U==1)return g.E(lL,tH(v,{mode:"readonly",vT:!0},function(AY){return JH(AY,"playbackData").then(function(Xw){var Qv=Xw.map(function(e){return e.transfer}).filter(function(e){return!!e}),Ft=Xw.map(function(e){return e.offlineVideoPolicy}).filter(function(e){return!!e}),h=Xw.filter(function(e){return!!e.key}).map(function(e){return g.zh(g.We(e.key).entityId,"downloadStatusEntity")});
Qv=JH(AY,"transfer",Qv);Ft=JH(AY,"offlineVideoPolicy",Ft);h=JH(AY,"downloadStatusEntity",h);var R=Qv.then(function(e){e=e.reduce(function(Z,n){(n==null?0:n.offlineVideoStreams)&&Z.push.apply(Z,g.F(n.offlineVideoStreams));return Z},[]).filter(function(Z){return!!Z});
return JH(AY,"offlineVideoStreams",e)});
return g.az.all([Qv,Ft,R,h]).then(function(e){var Z=g.y(e);e=Z.next().value;var n=Z.next().value;var Cn=Z.next().value;Z=Z.next().value;return[Xw,e,n,Cn,Z]})})}),2);
if(lL.U!=3)return O=lL.Y,g.E(lL,tH(v,{mode:"readonly",vT:!0},function(AY){return JH(AY,"mainDownloadsListEntity").then(function(Xw){var Qv,Ft;return(Ft=(Qv=Xw[0])==null?void 0:Qv.downloads)!=null?Ft:[]})}),3);
Y=lL.Y;S=g.y(O);d=S.next().value;r=S.next().value;b=S.next().value;z=S.next().value;M=S.next().value;V=d;A=r;f=b;k=z;U=M;c={};a={};x={};T={};l={};Q=[];L=g.y(A);for(I=L.next();!I.done;I=L.next())(t=I.value)&&(c[t.key]=t);P=g.y(f);for(YQ=P.next();!YQ.done;YQ=P.next())(dF=YQ.value)&&(a[dF.key]=dF);N=g.y(U);for(j1=N.next();!j1.done;j1=N.next())(D=j1.value)&&(x[D.key]=D);yd=g.y(k);for(pn=yd.next();!pn.done;pn=yd.next())(Qd=pn.value)&&(T[Qd.key]=Qd);uL=g.y(Y);for(jU=uL.next();!jU.done;jU=uL.next())ll=jU.value,
xQ=void 0,l[(xQ=ll.videoItem)!=null?xQ:""]=!0,ll.videoItem&&(p=dS=void 0,oi=(p=(dS=g.We(ll.videoItem))==null?void 0:dS.entityId)!=null?p:"",Q.push({externalVideoId:oi}));P0=V.filter(function(AY){if(!AY||!AY.key||!AY.offlineVideoPolicy)return!1;AY=g.We(AY.key).entityId;AY=g.zh(AY,"downloadStatusEntity");var Xw;return!(AY&&((Xw=x[AY])==null?void 0:Xw.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
uh=P0.map(function(AY){var Xw=c[AY.transfer],Qv=[];if(Xw==null?0:Xw.offlineVideoStreams)for(var Ft=g.y(Xw.offlineVideoStreams),h=Ft.next();!h.done;h=Ft.next())(h=T[h.value])&&Qv.push(h);Ft=a[AY.offlineVideoPolicy];h=l;var R=AY==null?void 0:AY.playerResponseTimestamp,e=g.We(Ft.key).entityId;AY=g.zh(e,"mainVideoEntity");if(Ft.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Z="OFFLINE_VIDEO_STATE_DISABLED";Ft.expirationTimestamp&&Number(Ft.expirationTimestamp)<Date.now()/1E3&&(Z="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Ft.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Z="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Xw==null?void 0:Xw.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Z="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Z="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Z="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Z="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Z="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Z="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Z="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Z==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Xw==null?void 0:Xw.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Z="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Z="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Z=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}e={id:e,videoState:Z};if(Xw==null?0:Xw.cotn)e.cotn=Xw.cotn;if(Xw==null?0:Xw.maximumDownloadQuality)e.selectedVideoQuality=Xw==null?void 0:Xw.maximumDownloadQuality;if(Xw==null?0:Xw.lastProgressTimeMs)e.lastProgressTimeMs=Xw.lastProgressTimeMs;R&&(e.playerResponseSavedTimeMs=String(Number(R)*1E3));Xw=String;R=0;Qv=g.y(Qv);for(Z=Qv.next();!Z.done;Z=Qv.next())if(Z=Z.value,Z.streamsProgress){Z=g.y(Z.streamsProgress);for(var n=Z.next();!n.done;n=Z.next()){var Cn=void 0;
R+=Number((Cn=n.value.numBytesDownloaded)!=null?Cn:0)}}e.downloadedBytes=Xw(R);e.selectedOfflineMode=h[AY]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Ft.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(e.offlinePlaybackDisabledReason=Ft.offlinePlaybackDisabledReason);return e});
return lL.return({offlineVideos:uh,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:Q}}})})},Jdw=function(){this.locks=navigator.locks},Kz8=function(){try{var v=g.il("ytglobal.locks_");
if(v)return v;var O;if(O=navigator){var Y=navigator;O="locks"in Y&&!!Y.locks}if(O)return g.Pm.localStorage&&g.Pm.localStorage.getItem("noop"),v=new Jdw,g.Gc("ytglobal.locks_",v),v}catch(S){}},Ow=function(){},Pd0=function(){},G7U=function(v){if(v.includes(":"))throw Error("Invalid user cache name: "+v);
return v+":"+g.mF("CacheStorage get")},iZL=function(){return g.B(function(v){if(Yq!==void 0)return v.return(Yq);
Yq=new Promise(function(O){var Y;return g.B(function(S){switch(S.U){case 1:return g.cm(S,2),g.E(S,Sw.open("test-only"),4);case 4:return g.E(S,Sw.delete("test-only"),5);case 5:g.ai(S,3);break;case 2:if(Y=g.Tc(S),Y instanceof Error&&Y.name==="SecurityError")return O(!1),S.return();case 3:O("caches"in window),g.UE(S)}})});
return v.return(Yq)})},tyY=function(){return g.B(function(v){if(v.U==1)return g.E(v,iZL(),2);
if(!v.Y)return v.return(void 0);mdJ||(mdJ=new Pd0);return v.return(mdJ)})},d9=function(v,O,Y){g.Br(new g.iK("Woffle: "+v,Y?{cotn:Y}:""));
O instanceof Error&&g.Br(O)},DdN=function(v){var O;
return g.B(function(Y){if(Y.U==1)return g.E(Y,n_v(v),2);O=Y.Y;g.z2("offlineStateSnapshot",O);g.UE(Y)})},r9=function(v){g.X.call(this);
var O=this;this.api=v;this.Qg={OMx:function(){return O.Y},
F2W:function(){return O.U}};
typeof g.Pm.BroadcastChannel!=="undefined"&&(this.Y=new g.Pm.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.mF()),this.Y.onmessage=this.G.bind(this),this.U=new g.Pm.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.mF()),this.U.onmessage=this.B.bind(this))},bD=function(v,O){v.api.PW("onOfflineOperationFailure",O);
var Y;(Y=v.Y)==null||Y.postMessage(O)},HZt=function(v,O,Y,S){var d=this;
this.X=v;this.j=O;this.visibility=Y;this.V=S;this.Z=this.L=this.C=this.G=this.Y=!1;this.B=new g.mX(function(){d.Hw()});
this.Qg={uR:function(){return d.U},
Hw:function(){d.Hw()},
XbO:function(){return d.B}};
this.visibility.subscribe("visibilitystatechange",function(){d.Gm()})},N1w=function(v){if(!v.G&&!v.Y){var O=Kz8();
if(O){v.G=!0;var Y=g.mF("OfflineLockManager");O.request("woffle_orchestration_leader:"+Y,{},function(){var S,d,r,b;return g.B(function(z){switch(z.U){case 1:return g.cm(z,2),v.U=new g.Mf,v.Y=!0,v.G=!1,g.E(z,v.X(),4);case 4:return g.E(z,v.U.promise,5);case 5:g.ai(z,0);break;case 2:S=g.Tc(z),((r=(d=v).V)==null?0:r.call(d,"wo_relinquish_leadership_on_lock_request_error"))||v.Hw(),S instanceof Error&&(b=S,b.args=[{name:"WoLockManagerError",rM:S.name}],g.LP(b)),g.UE(z)}})})}}},vHw=function(v){v.Y&&(v.Z=
!0,oc(v))},OBN=function(v,O){v.Y&&(v.C=O,oc(v))},YCJ=function(v,O){v.Y&&(v.L=O,oc(v))},oc=function(v){v.L&&v.C&&v.Z&&v.visibility.isBackground()?g.HM(v.B,6E4):v.B.stop()},jw=function(v){var O;
v.offlineDeleteReason=(O=v.offlineDeleteReason)!=null?O:"OFFLINE_DELETE_REASON_UNKNOWN";var Y;v.offlineModeType=(Y=v.offlineModeType)!=null?Y:"OFFLINE_NOW";g.z2("offlineDeleteEvent",v)},W9=function(v,O){var Y=O.videoId;
var S=O.py;O=O.offlineModeType;v.encryptedVideoId=Y;v.cotn=S==null?void 0:S.cotn;v.offlineabilityFormatType=S==null?void 0:S.maximumDownloadQuality;var d;v.isRefresh=(d=S==null?void 0:S.isRefresh)!=null?d:!1;var r;v.softErrorCount=(r=S==null?void 0:S.transferRetryCount)!=null?r:0;v.offlineModeType=O!=null?O:"OFFLINE_NOW";(v.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&v.statusType==="UNKNOWN_STATUS_TYPE"||!v.transferStatusType&&!v.statusType)&&g.Br(Error("Woffle unknown transfer status"));
g.z2("offlineTransferStatusChanged",v)},SCU=function(v){W9({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},v)},dfY=function(v,O,Y,S){S={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!S};O&&Y&&(O=Math.floor(O/1024).toFixed(),Y=Math.floor(Y/1024).toFixed(),S.alreadyDownloadedKbytes=O,S.totalFetchedKbytes=O,S.totalContentKbytes=Y);W9(S,v)},rUL=function(v){W9({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},v)},bBL=function(v){W9({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},v)},oH0=function(v){switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
z0=function(v){var O,Y,S;
return((S=(O=v.actionMetadata)==null?void 0:(Y=O.retryScheduleIntervalsInSeconds)==null?void 0:Y.length)!=null?S:0)>0},g9=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!v.entityKey},Mp=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!v.entityKey},V0=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!v.entityKey},jS0=function(v){return v.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!v.entityKey},
AD=function(v,O,Y,S,d){d=d===void 0?!1:d;
var r,b,z,M,V,A;return g.B(function(f){if(f.U==1)return r=g.zh(v,O),b=g.zh(v,"downloadStatusEntity"),g.E(f,tH(Y,{mode:"readonly",vT:!0},function(k){return g.az.all([nk(k,r,O),nk(k,b,"downloadStatusEntity")])}),2);
z=f.Y;M=z.length?z[0]:void 0;if(!M)return f.d8(0);V=WRL;if(A=z.length>1?z[1]:void 0){if(A.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!d)return f.return();A.downloadState=S}else A={key:b,downloadState:S};g.bi(M,V,A);return g.E(f,tH(Y,{mode:"readwrite",vT:!0},function(k){return g.az.all([PF(k,M,O),PF(k,A,"downloadStatusEntity")])}),0)})},f1=function(v,O){return v.actionType===O.actionType&&v.entityKey===O.entityKey},$q=function(v,O){if(v&&v.transferState!=="TRANSFER_STATE_COMPLETE"&&v.transferState!==
"TRANSFER_STATE_FAILED"){var Y=g.We(v.key).entityId;
W9({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:Y,py:v,offlineModeType:O})}},kq=function(v){if(!v||!v.thumbnails)return[];
var O=[];v=g.y(v.thumbnails);for(var Y=v.next();!Y.done;Y=v.next())Y=Y.value,Y.url&&O.push(Y.url);return O},zOJ=function(v,O,Y){Y=Y===void 0?[]:Y;
var S,d,r,b,z,M,V,A,f,k,U,c,a;return g.B(function(x){if(x.U==1)return Y.length?g.E(x,NT(v,O),2):x.return([]);S=x.Y;d=new Set;r=g.y(S);for(b=r.next();!b.done;b=r.next())if(z=b.value,M=z.id||z.key)V=g.We(M).entityId,d.add(V);A=[];f=g.y(Y);for(k=f.next();!k.done;k=f.next())U=k.value,c=U.offlineVideoData,a=void 0,((a=c)==null?0:a.videoId)&&!d.has(c.videoId)&&A.push(U);return x.return(A)})},sSJ=function(v,O,Y){return new g.w2(v,{cotn:O,
raw_player_response:Y,download_media:!0,start:Infinity,disable_watch_next:!0})},gHC=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Uw=function(v,O,Y,S,d,r,b,z,M,V,A){this.entityType=v;
this.actionId=O;this.action=Y;this.parentActionId=S;this.rootActionId=d===void 0?O:d;this.childActionIds=r;this.prereqActionId=b;this.postreqActionIds=z;this.hasChildActionFailed=V;this.retryScheduleIndex=0;this.Y=A||Date.now();this.retryScheduleIndex=M||0},c9=function(v){if(!v.key)throw Error("Entity key is required.");
if(!v.actionProto)throw Error("OfflineOrchestrationAction is required.");var O=g.We(v.key),Y=g.We(v.actionProto.entityKey);return new Uw(Y.entityType,O.entityId,v.actionProto,v.parentActionId,v.rootActionId,v.childActionIds,v.prereqActionId,v.postreqActionIds,v.retryScheduleIndex,v.hasChildActionFailed,Number(v.enqueueTimeSec)*1E3)},uD=function(v){return{key:g.zh(v.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:v.action,parentActionId:v.parentActionId,rootActionId:v.rootActionId,childActionIds:v.childActionIds,prereqActionId:v.prereqActionId,postreqActionIds:v.postreqActionIds,retryScheduleIndex:v.retryScheduleIndex,hasChildActionFailed:v.hasChildActionFailed,enqueueTimeSec:(v.Y/1E3).toFixed()}},Mm8=function(){var v;
return g.B(function(O){return O.U==1?g.E(O,tyY(),2):(v=O.Y)?O.return(v.delete("yt-player-local-img")):O.return(!0)})},C1=function(v){var O,Y;
return g.B(function(S){if(S.U==1)return g.E(S,tyY(),2);if(S.U!=3){O=S.Y;if(!O)throw Error("Cache API not supported");return v.length?g.E(S,O.open("yt-player-local-img"),3):S.return()}Y=S.Y;return g.E(S,Promise.all(v.map(function(d){return Y.delete(d)})),0)})},y0=function(v){var O,Y;
return g.B(function(S){if(S.U==1)return g.E(S,tyY(),2);if(S.U!=3){O=S.Y;if(!O)throw Error("Cache API not supported");return v.length?g.E(S,O.open("yt-player-local-img"),3):S.return()}Y=S.Y;return g.E(S,Y.addAll(v),0)})},ac=function(v,O,Y,S,d){var r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ;
return g.B(function(dS){switch(dS.U){case 1:return r=g.zh(v,"mainVideoEntity"),b=g.zh(v,"ytMainChannelEntity"),z=g.zh(v,"transfer"),M=g.zh(v,"videoDownloadContextEntity"),g.E(dS,tH(O,{mode:"readonly",vT:!0},function(p){return g.az.all([nk(p,r,"mainVideoEntity"),nk(p,b,"ytMainChannelEntity"),nk(p,z,"transfer"),nk(p,M,"videoDownloadContextEntity"),JH(p,"ytMainChannelEntity"),JH(p,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:V=dS.Y;A=g.y(V);f=A.next().value;k=A.next().value;U=A.next().value;c=A.next().value;a=A.next().value;x=A.next().value;T=f;l=k;Q=U;L=c;I=a;t=x;if(!T&&!l){dS.d8(3);break}P=T?kq(T.thumbnail):[];if(!l){YQ=[];dS.d8(4);break}return g.E(dS,VmC(l,I),5);case 5:YQ=dS.Y;case 4:return dF=YQ,g.E(dS,C1(P.concat(dF)),3);case 3:N=[];j1=g.zh(v,"downloadStatusEntity");D=g.y(t);for(yd=D.next();!yd.done;yd=D.next())pn=yd.value,Qd=g.We(pn.key).entityId,uL=c9(pn),jU=g.We(uL.action.entityKey).entityId,Qd!==v&&jU!==
v||f1(Y,pn.actionProto)||N.push(pn.key);return g.E(dS,tH(O,{mode:"readwrite",vT:!0},function(p){var oi=N.map(function(P0){return Gl(p,P0)});
oi.push(Gl(p,r,{C3:!0}));oi.push(Gl(p,j1,{C3:!0}));return g.az.all(oi)}),7);
case 7:xQ=(ll=L)==null?void 0:ll.offlineModeType,d&&(jw(d),d.offlineModeType&&(xQ=d.offlineModeType)),$q(Q,xQ),bD(S,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.UE(dS)}})},$fY=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p,oi,P0,uh,lL,AY,Xw,Qv,Ft,h,R,e,Z,n,Cn,OE,kQ;
return g.B(function(S1){switch(S1.U){case 1:return d=g.zh(v,"mainPlaylistEntity"),r=g.zh(v,"ytMainChannelEntity"),g.E(S1,tH(O,{mode:"readonly",vT:!0},function(h3){return g.az.all([nk(h3,d,"mainPlaylistEntity"),nk(h3,r,"ytMainChannelEntity"),JH(h3,"mainPlaylistEntity"),JH(h3,"mainDownloadsListEntity"),JH(h3,"ytMainChannelEntity"),JH(h3,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=S1.Y;z=g.y(b);M=z.next().value;V=z.next().value;A=z.next().value;f=z.next().value;k=z.next().value;U=z.next().value;c=M;a=V;x=A;T=f;l=k;Q=U;if(!c&&!a){S1.d8(3);break}L=c?AUY(c):[];if(!a){I=[];S1.d8(4);break}return g.E(S1,VmC(a,l),5);case 5:I=S1.Y;case 4:return t=I,g.E(S1,C1(L.concat(t)),3);case 3:P=[];YQ=new Map;if(!c){S1.d8(7);break}return g.E(S1,fqJ(c,x,T),8);case 8:P=S1.Y;dF=g.y(P);for(N=dF.next();!N.done;N=dF.next())j1=N.value,YQ.set(j1,{videoId:j1,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.E(S1,tH(O,{mode:"readonly",vT:!0},function(h3){return g.az.all([JH(h3,"transfer"),JH(h3,"videoDownloadContextEntity")])}),9);
case 9:D=S1.Y;yd=g.y(D);pn=yd.next().value;Qd=yd.next().value;uL=pn;jU=Qd;ll=g.y(uL);for(xQ=ll.next();!xQ.done;xQ=ll.next())dS=xQ.value,p=g.We(dS.key).entityId,(oi=YQ.get(p))&&dS&&(oi.cotn=dS.cotn);P0=g.y(jU);for(uh=P0.next();!uh.done;uh=P0.next())lL=uh.value,AY=g.We(lL.key).entityId,(Xw=YQ.get(AY))&&lL&&(Xw.offlineModeType=lL.offlineModeType);case 7:Qv=[];Ft=g.y(Q);for(h=Ft.next();!h.done;h=Ft.next())R=h.value,e=g.We(R.key).entityId,Z=c9(R),e!==v&&Z.rootActionId!==v||f1(Y,R.actionProto)||Qv.push(R.key);
n=g.zh(v,"mainPlaylistEntity");return g.E(S1,tH(O,{mode:"readwrite",vT:!0},function(h3){var t3=Qv.map(function(yv){return Gl(h3,yv)});
t3.push(Gl(h3,n,{C3:!0}));return g.az.all(t3)}),10);
case 10:if(!c){S1.d8(0);break}P.reverse();if(!P){S1.d8(0);break}Cn=g.y(P);OE=Cn.next();case 13:if(OE.done){S1.d8(0);break}kQ=OE.value;return g.E(S1,ac(kQ,O,Y,S,YQ.get(kQ)),14);case 14:OE=Cn.next(),S1.d8(13)}})},Uf0=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k;
return g.B(function(U){if(U.U==1)return d=g.zh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),r=new Map,g.E(U,tH(v,{mode:"readwrite",vT:!0},function(c){var a=JH(c,"transfer"),x=JH(c,"offlineOrchestrationActionWrapperEntity"),T=JH(c,"videoDownloadContextEntity"),l=nk(c,d,"mainDownloadsListEntity");return g.az.all([a,x,T,l]).then(function(Q){Q=g.y(Q);var L=Q.next().value;var I=Q.next().value;var t=Q.next().value;var P=Q.next().value;Q=k_Y.map(function(dF){return MyL(c,dF)});
I=g.y(I);for(var YQ=I.next();!YQ.done;YQ=I.next())YQ=YQ.value,f1(O,YQ.actionProto)||Q.push(Gl(c,YQ.key,{C3:!0}));P&&(P.downloads=[],Q.push(PF(c,P,"mainDownloadsListEntity")));if(t)for(t=g.y(t),P=t.next();!P.done;P=t.next())P=P.value,I=g.We(P.key).entityId,I=g.zh(I,"transfer"),r.set(I,P.offlineModeType);return g.az.all(Q).then(function(){return L})})}),2);
b=U.Y;z=g.y(b);for(M=z.next();!M.done;M=z.next())V=M.value,$q(V,r.get(V.key)),A=g.We(V.key).entityId,f={videoId:A,offlineDeleteReason:S,cotn:V.cotn,offlineModeType:r.get(V.key)},jw(f),k=g.zh(A,"mainVideoEntity"),bD(Y,{entityKey:k,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.E(U,Mm8(),0)})},AUY=function(v,O){var Y=[];
if(v.thumbnailStyleData){v=g.y(v.thumbnailStyleData);for(var S=v.next();!S.done;S=v.next()){var d=void 0,r=void 0,b=void 0;Y=Y.concat(kq((d=S.value)==null?void 0:(r=d.value)==null?void 0:(b=r.collageThumbnail)==null?void 0:b.coverThumbnail))}}O=kq(O);return Y.concat(O)},fqJ=function(v,O,Y){var S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF;
return g.B(function(N){S=[];d=new Set;if(Y.length)for(r=g.y(Y),b=r.next();!b.done;b=r.next())if(z=b.value,M=void 0,(M=z.downloads)==null?0:M.length)for(V=g.y(z.downloads),A=V.next();!A.done;A=V.next())f=A.value,f.videoItem&&(k=g.We(f.videoItem).entityId,d.add(k));if(v.videos){U=g.y(v.videos);for(c=U.next();!c.done;c=U.next())a=c.value,x=JSON.parse(g.We(a).entityId),x.videoId&&!d.has(x.videoId)&&S.push(x.videoId);T=g.y(O);for(l=T.next();!l.done;l=T.next())if(Q=l.value,Q.key!==v.key&&(L=Q.videos))for(I=
g.y(L),t=I.next();!t.done;t=I.next())P=t.value,YQ=JSON.parse(g.We(P).entityId),YQ.videoId&&(dF=S.indexOf(YQ.videoId),dF!==-1&&S.splice(dF,1))}return N.return(S)})},VmC=function(v,O){var Y,S,d,r,b,z,M,V;
return g.B(function(A){Y=kq(v.avatar);S=g.y(O);for(d=S.next();!d.done;d=S.next())if(r=d.value,r.id!==v.id)for(b=g.y(kq(r.avatar)),z=b.next();!z.done;z=b.next())M=z.value,V=Y.indexOf(M),V!==-1&&Y.splice(V,1);return A.return(Y)})},cUw=function(v){var O;
return g.B(function(Y){O=g.q(v.frameworkUpdates,xq);return v.frameworkUpdates&&O?g.E(Y,ptY(O),0):Y.return()})},CeU=function(v){var O;
if((O=v.onResponseReceivedActions)!=null&&O.length){var Y;v=(Y=g.q(g.q(v.onResponseReceivedActions[0],uQt),g.QTt))==null?void 0:Y.actions;if(v!=null&&v.length)return v}},yUw=function(v){var O,Y,S;
return g.B(function(d){if(d.U==1)return v?g.E(d,HF(v,g.Q1,"mainDownloadsListEntity"),2):d.return([]);O=d.Y;return((Y=O)==null?0:(S=Y.downloads)==null?0:S.length)?d.return(O.downloads.map(function(r){var b;return(b=r.videoItem)!=null?b:""})):d.return([])})},xfN=function(v,O){var Y;
return g.B(function(S){return S.U==1?g.E(S,aqY(v,O),2):(Y=S.Y)?g.E(S,tH(v,{mode:"readwrite",vT:!0},function(d){var r=[PF(d,Y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];Y.mainDownloadsListEntity&&r.push(PF(d,Y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.az.all(r)}),0):S.d8(0)})},aqY=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q;
return g.B(function(L){if(L.U==1)return Y=g.zh("main_downloads_library_id","mainDownloadsLibraryEntity"),S=g.zh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.E(L,tH(v,{mode:"readonly",vT:!0},function(I){return g.az.all([nk(I,Y,"mainDownloadsLibraryEntity"),nk(I,S,"mainDownloadsListEntity")])}),2);
d=L.Y;r=g.y(d);b=r.next().value;z=r.next().value;M=b;V=z;M||(M={id:Y});A=g.y(O);for(f=A.next();!f.done;f=A.next())if(k=f.value,k===g.Q1){if(M.smartDownloadsList)return L.return();M.smartDownloadsList=k}else if(U=g.We(k).entityType,c={},U==="mainPlaylistEntity"?c.playlistItem=k:U==="mainVideoEntity"&&(c.videoItem=k),!g.tY(c)){a=void 0;if((a=V)==null?0:a.downloads){x=!1;T=g.y(V.downloads);for(l=T.next();!l.done;l=T.next())if(Q=l.value,Q.playlistItem===k||Q.videoItem===k){x=!0;break}x||V.downloads.push(c)}else V=
{id:S,downloads:[c]};M.downloadsList=S}return L.return({mainDownloadsLibraryEntity:M,mainDownloadsListEntity:V})})},plN=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x;
return g.B(function(T){if(T.U==1)return Y=g.zh("main_downloads_library_id","mainDownloadsLibraryEntity"),S=g.zh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.E(T,tH(v,{mode:"readonly",vT:!0},function(l){return g.az.all([nk(l,Y,"mainDownloadsLibraryEntity"),nk(l,S,"mainDownloadsListEntity"),nk(l,g.Q1,"mainDownloadsListEntity")])}),2);
d=T.Y;r=g.y(d);b=r.next().value;z=r.next().value;M=r.next().value;V=b;A=z;f=M;if(!V)return T.d8(0);if(O===g.Q1&&((k=f)==null?0:k.downloads))f.downloads=[];else if((U=A)==null?0:U.downloads)for(c=g.We(O).entityType,a=0;a<A.downloads.length;a++)if(x=A.downloads[a],c==="mainVideoEntity"&&x.videoItem===O){A.downloads.splice(a,1);break}else if(c==="mainPlaylistEntity"&&x.playlistItem===O){A.downloads.splice(a,1);break}return g.E(T,tH(v,{mode:"readwrite",vT:!0},function(l){var Q=[PF(l,V,"mainDownloadsLibraryEntity")];
A&&Q.push(PF(l,A,"mainDownloadsListEntity"));f&&Q.push(PF(l,f,"mainDownloadsListEntity"));return g.az.all(Q)}),0)})},p1=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k;
return g.B(function(U){if(U.U==1)return Y=g.zh(O,"transfer"),S=g.zh(O,"videoDownloadContextEntity"),g.E(U,tH(v,{mode:"readonly",vT:!0},function(c){return g.az.all([nk(c,Y,"transfer"),nk(c,S,"videoDownloadContextEntity")])}),2);
d=U.Y;r=g.y(d);b=r.next().value;z=r.next().value;M=b;V=z;k={videoId:O,cotn:(A=M)==null?void 0:A.cotn,offlineModeType:(f=V)==null?void 0:f.offlineModeType};return U.return(k)})},T0=function(v,O,Y,S,d){var r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ;
return g.B(function(dF){switch(dF.U){case 1:return r=g.zh(v,"musicTrack"),b=g.zh(v,"transfer"),g.E(dF,tH(O,{mode:"readonly",vT:!0},function(N){return g.az.all([nk(N,r,"musicTrack"),nk(N,b,"transfer"),JH(N,"musicTrack"),JH(N,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:z=dF.Y;M=g.y(z);V=M.next().value;A=M.next().value;f=M.next().value;k=M.next().value;U=V;c=A;a=f;x=k;if(!U){dF.d8(3);break}return g.E(dF,TAK(U,a),4);case 4:return T=dF.Y,g.E(dF,C1(T),3);case 3:l=[];Q=g.y(x);for(L=Q.next();!L.done;L=Q.next())I=L.value,t=g.We(I.key).entityId,P=c9(I),YQ=g.We(P.action.entityKey).entityId,t!==v&&YQ!==v||f1(Y,I.actionProto)||l.push(I.key);return g.E(dF,tH(O,{mode:"readwrite",vT:!0},function(N){var j1=l.map(function(D){return Gl(N,D)});
j1.push(Gl(N,r,{C3:!0}));return g.az.all(j1)}),6);
case 6:$q(c),d&&jw(d),bD(S,{entityKey:r,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.UE(dF)}})},lD=function(v,O,Y,S,d){var r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p,oi,P0,uh;
return g.B(function(lL){switch(lL.U){case 1:return r=g.zh(v,O),b=g.zh("music_downloads_library_id","musicDownloadsLibraryEntity"),g.E(lL,tH(Y,{mode:"readonly",vT:!0},function(AY){return g.az.all([nk(AY,r,O),nk(AY,b,"musicDownloadsLibraryEntity"),JH(AY,O),JH(AY,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:z=lL.Y;M=g.y(z);V=M.next().value;A=M.next().value;f=M.next().value;k=M.next().value;U=V;c=A;a=f;x=k;if(!U){lL.d8(3);break}return g.E(lL,TAK(U,a),4);case 4:return T=lL.Y,g.E(lL,C1(T),3);case 3:l=[];Q=new Map;if(!U){lL.d8(6);break}return g.E(lL,lqC(U,a,c),7);case 7:l=lL.Y;L=g.y(l);for(I=L.next();!I.done;I=L.next())t=I.value,P=g.We(t).entityId,Q.set(P,{videoId:P,playlistId:v,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.E(lL,NT(Y,"transfer"),8);case 8:for(YQ=lL.Y,dF=
g.y(YQ),N=dF.next();!N.done;N=dF.next())j1=N.value,D=g.We(j1.key).entityId,(yd=Q.get(D))&&j1&&(yd.cotn=j1.cotn);case 6:pn=[];Qd=g.y(x);for(uL=Qd.next();!uL.done;uL=Qd.next())jU=uL.value,ll=g.We(jU.key).entityId,xQ=c9(jU),ll!==v&&xQ.rootActionId!==v||f1(S,jU.actionProto)||pn.push(jU.key);dS=g.zh(v,O);return g.E(lL,tH(Y,{mode:"readwrite",vT:!0},function(AY){var Xw=pn.map(function(Qv){return Gl(AY,Qv)});
Xw.push(Gl(AY,dS,{C3:!0}));return g.az.all(Xw)}),9);
case 9:if(!U){lL.d8(0);break}l.reverse();if(!l.length){lL.d8(0);break}p=g.y(l);oi=p.next();case 12:if(oi.done){lL.d8(0);break}P0=oi.value;uh=g.We(P0).entityId;if(!uh){lL.d8(13);break}return g.E(lL,T0(uh,Y,S,d,Q.get(uh)),13);case 13:oi=p.next(),lL.d8(12)}})},F1=function(v,O,Y){var S,d,r,b,z,M,V;
return g.B(function(A){if(A.U==1)return g.E(A,tH(v,{mode:"readwrite",vT:!0},function(f){var k=JH(f,"transfer"),U=JH(f,"offlineOrchestrationActionWrapperEntity");return g.az.all([k,U]).then(function(c){c=g.y(c);var a=c.next().value;var x=c.next().value;c=FRN.map(function(L){return MyL(f,L)});
x=g.y(x);for(var T=x.next();!T.done;T=x.next()){T=T.value;var l=g.We(T.actionProto.entityKey).entityType==="musicTrack",Q=T.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";f1(O,T.actionProto)||l&&(!l||Q)||c.push(Gl(f,T.key,{C3:!0}))}return g.az.all(c).then(function(){return a})})}),2);
S=A.Y;d=g.y(S);for(r=d.next();!r.done;r=d.next())b=r.value,$q(b),z=g.We(b.key).entityId,M={videoId:z,offlineDeleteReason:void 0,cotn:b.cotn},jw(M),V=g.zh(z,"musicTrack"),bD(Y,{entityKey:V,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.E(A,Mm8(),0)})},hOC=function(v){for(var O,Y=g.y(v.additionalMetadatas),S=Y.next();!S.done;S=Y.next())S=S.value,S.offlineMusicVideoData&&(O=S.offlineMusicVideoData);
var d,r,b,z,M;return{id:g.zh(v.videoId,"musicTrack"),videoId:v.videoId,title:v.title,thumbnailDetails:v.thumbnail,lengthMs:String(Number(v.lengthSeconds)*1E3),albumTitle:(d=O)==null?void 0:d.releaseTitle,musicVideoType:(r=O)==null?void 0:r.musicVideoType,contentRating:{explicitType:(b=O)==null?void 0:b.explicitType},artistNames:((z=O)==null?void 0:z.byline)||((M=O)==null?void 0:M.channelName),downloadMetadata:g.zh(v.videoId,"musicTrackDownloadMetadataEntity")}},lqC=function(v,O,Y){var S,d,r,b,z,M,
V,A,f,k,U,c,a,x,T,l,Q,L;
return g.B(function(I){S=[];d=new Set;if((r=Y)==null?0:(b=r.downloadedTracks)==null?0:b.length)for(z=g.y(Y.downloadedTracks),M=z.next();!M.done;M=z.next())V=M.value,d.add(V);if(v.tracks){A=g.y(v.tracks);for(f=A.next();!f.done;f=A.next())k=f.value,d.has(k)||S.push(k);U=g.y(O);for(c=U.next();!c.done;c=U.next())if(a=c.value,a.id!==v.id&&(x=a.tracks))for(T=g.y(x),l=T.next();!l.done;l=T.next())Q=l.value,L=S.indexOf(Q),L!==-1&&S.splice(L,1)}return I.return(S)})},TAK=function(v,O){var Y,S,d,r,b,z,M,V;
return g.B(function(A){Y=kq(v.thumbnailDetails);S=g.y(O);for(d=S.next();!d.done;d=S.next())if(r=d.value,r.id!==v.id)for(b=g.y(kq(r.thumbnailDetails)),z=b.next();!z.done;z=b.next())M=z.value,V=Y.indexOf(M),V!==-1&&Y.splice(V,1);return A.return(Y)})},ROK=function(v,O){var Y,S,d,r,b,z,M,V,A;
return g.B(function(f){if(f.U==1)return Y=g.zh("music_downloads_library_id","musicDownloadsLibraryEntity"),g.E(f,HF(v,Y,"musicDownloadsLibraryEntity"),2);(S=f.Y)||(S={id:Y});d=g.We(O).entityType;d==="musicTrack"?(r=S.downloadedTracks)!=null&&r.includes(O)||(S.downloadedTracks=((b=S.downloadedTracks)!=null?b:[]).concat(O)):d==="musicPlaylist"?(z=S.downloadedPlaylists)!=null&&z.includes(O)||(S.downloadedPlaylists=((M=S.downloadedPlaylists)!=null?M:[]).concat(O)):d!=="musicAlbumRelease"||(V=S.downloadedAlbumReleases)!=
null&&V.includes(O)||(S.downloadedAlbumReleases=((A=S.downloadedAlbumReleases)!=null?A:[]).concat(O));return g.E(f,D7(v,S,"musicDownloadsLibraryEntity"),0)})},eOS=function(v,O){var Y,S,d,r,b,z,M;
return g.B(function(V){if(V.U==1)return Y=g.zh("music_downloads_library_id","musicDownloadsLibraryEntity"),g.E(V,HF(v,Y,"musicDownloadsLibraryEntity"),2);S=V.Y;if(!S)return V.d8(0);d=g.We(O).entityType;d==="musicTrack"?r=S.downloadedTracks:d==="musicPlaylist"&&(r=S.downloadedPlaylists);if((b=r)==null?0:b.length)for(z=0;z<r.length;z++)if(M=r[z],M===O){r.splice(z,1);break}return g.E(V,D7(v,S,"musicDownloadsLibraryEntity"),0)})},EHt=function(v){var O=v.videos;
v=[];var Y=[];if(O){O=g.y(O);for(var S=O.next();!S.done;S=O.next()){var d=S.value.offlineVideoData.videoId;S=g.zh(d,"musicTrack");d=g.zh(d,"musicTrackDownloadMetadataEntity");v.push(S);Y.push(d)}}return{MA:v,G4:Y}},hD=function(v,O,Y){O={track:hOC(O)};
Y&&(O.playlistId=Y);if(v=g.q(v.actionMetadata,QSL))O.maximumDownloadQuality=v.maximumDownloadQuality;return{musicTrackEntityActionMetadata:O}},BAU=function(v){var O,Y,S,d,r,b,z,M;
return g.B(function(V){switch(V.U){case 1:return O=g.ju(),Y=QwN(v),S=g.V7(LRY),g.cm(V,2),r={EZ:!0},g.E(V,g.D9(O,Y,S,void 0,r),4);case 4:d=V.Y;g.ai(V,3);break;case 2:b=g.Tc(V);if(b instanceof g.rf)throw z="GetOffline network manager error: "+b.message,d9(z,b),Error(z);d9("GetOffline fetch request error",b);throw Error("GetOffline fetch request error");case 3:M=Rc(d);if(!d)throw d9("Network request failed"),Error("Network request failed");if(M!==void 0)ew(M);else if(!d.videos||!d.videos.length)throw d9("No data"),
Error("No data");return V.return(d.videos.map(function(A){return A.offlineVideoData}))}})},ZBv=function(v){var O,Y,S,d,r,b,z,M;
return g.B(function(V){switch(V.U){case 1:return O=g.ju(),Y=LzN(v),S=g.V7(LRY),g.cm(V,2),r={EZ:!0},g.E(V,g.D9(O,Y,S,void 0,r),4);case 4:d=V.Y;g.ai(V,3);break;case 2:b=g.Tc(V);if(b instanceof g.rf)throw z="GetOffline network manager error for playlist: "+b.message,d9(z,b),Error(z);d9("GetOffline fetch request error for playlist",b);throw Error("GetOffline fetch request error for playlist");case 3:M=Rc(d);if(!d)throw d9("Network request failed for playlist"),Error("Network request failed for playlist");
if(M!==void 0)ew(M,"playlist");else if(!d.playlists||!d.playlists.length)throw d9("No data for playlist"),Error("No data for playlist");return V.return(d.playlists.map(function(A){return A.offlinePlaylistData}))}})},wlN=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU;
return g.B(function(ll){switch(ll.U){case 1:return g.E(ll,v9(),2);case 2:d=ll.Y;if(!d)return ll.return([]);r=[];if((b=S)==null?0:b.length){r=S;ll.d8(3);break}return g.E(ll,NT(d,"mainPlaylistEntity"),4);case 4:r=ll.Y;case 3:if(!r.length)return ll.return([]);z=[];M=Date.now()/1E3;V=g.y(r);A=V.next();case 5:if(A.done)return z.length?g.E(ll,XlJ(z),10):ll.return([]);f=A.value;if(!f.downloadState){k=void 0;ll.d8(8);break}return g.E(ll,HF(d,f.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:k=
ll.Y;case 8:U=k;c=void 0;x=(a=(c=f)==null?void 0:c.entityMetadata)&&a.nextAutoRefreshIntervalSeconds?Number(a.nextAutoRefreshIntervalSeconds):NaN;T=Number.isNaN(x)?v:x;Q=l=void 0;L=((l=U)==null?0:l.lastSyncedTimestampMillis)?Number((Q=U)==null?void 0:Q.lastSyncedTimestampMillis)/1E3:0;t=I=void 0;P=((I=U)==null?0:I.addedTimestampMillis)?Number((t=U)==null?void 0:t.addedTimestampMillis)/1E3:0;if(Y||!a||L+T<=M){YQ=[];dF=void 0;if((dF=f.videos)==null?0:dF.length)for(N=g.y(f.videos),j1=N.next();!j1.done;j1=
N.next())D=j1.value,yd=JSON.parse(g.We(D).entityId),yd.videoId&&YQ.push(yd.videoId);pn="0";a&&(Qd=void 0,pn=String(Number((Qd=a.offlineLastModifiedTimestampSeconds)!=null?Qd:0).toFixed()));uL={playlistId:f.playlistId,videoIds:YQ,offlineLastModifiedTimestamp:pn,autoSync:O,offlineDateAddedTimestamp:String(P.toFixed())};z.push(uL)}A=V.next();ll.d8(5);break;case 10:return jU=ll.Y,ll.return(jU)}})},Iqv=function(){var v,O,Y,S,d;
return g.B(function(r){if(r.U==1)return g.E(r,v9(),2);if(r.U!=3)return(v=r.Y)?g.E(r,NT(v,"refresh"),3):r.return(!1);O=r.Y;if((Y=O[0])==null||!Y.refreshTime)return r.return(!1);S=Number(O[0].refreshTime);d=Date.now()/1E3;return r.return(isFinite(S)&&d>=S)})},nHL=function(v,O){var Y,S,d;
return g.B(function(r){switch(r.U){case 1:return g.cm(r,2),g.E(r,qCS(v,O),4);case 4:return S=r.Y,g.E(r,cUw(S),5);case 5:Y=CeU(S);g.ai(r,3);break;case 2:d=g.Tc(r),d9("getAndProcessSmartDownloadsResponse request or processing error",d);case 3:return r.return(Y)}})},JUN=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU;
return g.B(function(ll){switch(ll.U){case 1:return g.E(ll,v9(),2);case 2:d=ll.Y;if(!d)return ll.return([]);r=[];if((b=S)==null?0:b.length){r=S;ll.d8(3);break}return g.E(ll,NT(d,"musicPlaylist"),4);case 4:r=ll.Y;case 3:if(!r.length)return ll.return([]);z=[];M=Date.now()/1E3;V=g.y(r);A=V.next();case 5:if(A.done)return z.length?g.E(ll,XlJ(z),10):ll.return([]);f=A.value;k=void 0;c=(U=(k=f)==null?void 0:k.entityMetadata)&&U.nextAutoRefreshIntervalSeconds?Number(U.nextAutoRefreshIntervalSeconds):NaN;a=
Number.isNaN(c)?v:c;T=x=0;l="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!f.downloadMetadata){ll.d8(8);break}return g.E(ll,HF(d,f.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:Q=ll.Y,I=L=void 0,x=Number((I=(L=Q)==null?void 0:L.addedTimestampMillis)!=null?I:"0")/1E3,P=t=void 0,T=Number((P=(t=Q)==null?void 0:t.lastModifiedTimestampMillis)!=null?P:"0")/1E3,dF=YQ=void 0,l=(dF=(YQ=Q)==null?void 0:YQ.syncState)!=null?dF:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:N=void 0;if(Y||l!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!U||Number((N=U.lastSyncedTimestampSeconds)!=null?N:0)+a<=M){j1=[];D=void 0;if((D=f.tracks)==null?0:D.length)for(yd=g.y(f.tracks),pn=yd.next();!pn.done;pn=yd.next())Qd=pn.value,j1.push(g.We(Qd).entityId);uL={playlistId:f.playlistId,videoIds:j1,offlineLastModifiedTimestamp:String(T.toFixed()),autoSync:O,offlineDateAddedTimestamp:String(x.toFixed())};z.push(uL)}A=V.next();ll.d8(5);break;case 10:return jU=ll.Y,ll.return(jU)}})},qCS=function(v,O){var Y,S,d,r,b,z,M,V,A,f;
return g.B(function(k){switch(k.U){case 1:return Y=g.ju(),g.E(k,v9(),2);case 2:S=k.Y;if(!S){k.d8(3);break}return g.E(k,n_v(S),4);case 4:d=k.Y;case 3:var U=d;r={context:g.O4(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:v},offlineClientState:U,clientStateRequestData:{preferredFormatType:O}}}};b=g.V7(KR8);g.cm(k,5);M={EZ:!0};return g.E(k,g.D9(Y,r,b,void 0,M),7);case 7:z=k.Y;g.ai(k,6);break;case 5:V=g.Tc(k);if(V instanceof g.rf)throw A=
"DPS network manager error for smart downloads: "+V.message,d9(A,V),Error(A);d9("DPS fetch request error for smart downloads",V);throw Error("DPS fetch request error for smart downloads");case 6:f=Rc(z);if(z)f!==void 0&&ew(f,"smart downloads");else throw d9("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return k.return(z)}})},G_S=function(v,O){var Y,S,d,r,b,z,M,V;
return g.B(function(A){switch(A.U){case 1:return Y=g.ju(),S={context:g.O4(),videoPlaybackPositionEntities:v,lastSyncTimestampUsec:O},d=g.V7(PeN),g.cm(A,2),b={EZ:!0},g.E(A,g.D9(Y,S,d,void 0,b),4);case 4:r=A.Y;g.ai(A,3);break;case 2:z=g.Tc(A);if(z instanceof g.rf)throw M="VPPS network manager error: "+z.message,d9(M,z),Error(M);d9("VPPS fetch request error",z);throw Error("VPPS fetch request error");case 3:V=Rc(r);if(r)V!==void 0&&ew(V,"position sync");else throw d9("Network request failed for position sync"),
Error("Network request failed for position sync");return A.return(r)}})},mfN=function(v,O,Y){var S,d,r,b,z,M,V,A;
return g.B(function(f){switch(f.U){case 1:S=g.ju();var k=Y.refreshData,U=Y.isEnqueuedForExpiredStreamUrlRefetch,c=Y.uE,a=Y.offlineSourceData,x=Y.mediaCapabilities,T={entityKey:v};k&&(T.refreshData=k);U&&(T.isExpiredStreamUrlRefetch=U);c&&(T.downloadParameters=c);a&&(T.offlineSourceData=a);k={context:g.G3(O),signatureTimestamp:20227,videos:[T]};x&&(k.mediaCapabilities=x);d=k;r=g.V7(iBN);g.cm(f,2);z={EZ:!0};return g.E(f,g.D9(S,d,r,void 0,z),4);case 4:b=f.Y;g.ai(f,3);break;case 2:M=g.Tc(f);if(M instanceof
g.rf)throw V="GetPDE network manager error: "+M.message,d9(V,M),Error(V);d9("GetPDE fetch request error",M);throw Error("GetPDE fetch request error");case 3:A=Rc(b);if(b)A!==void 0&&ew(A,"PDE");else throw d9("Network request failed for PDE"),Error("Network request failed for PDE");return f.return(b)}})},Rc=function(v){var O;
return(O=v.errorMetadata)==null?void 0:O.status},ew=function(v,O){O=O?" for "+O:"";
if(v===0)throw v="Empty response body"+O,d9(v),Error(v);v="Response with error"+O;d9(v);throw Error(v);},XlJ=function(v){var O,Y,S,d,r,b,z,M;
return g.B(function(V){switch(V.U){case 1:return O=g.ju(),Y=B1Y(v),S=g.V7(tmN),g.cm(V,2),r={EZ:!0},g.E(V,g.D9(O,Y,S,void 0,r),4);case 4:d=V.Y;g.ai(V,3);break;case 2:b=g.Tc(V);if(b instanceof g.rf)throw z="offlinePlaylistSyncCheck network manager error: "+b.message,d9(z,b),Error(z);d9("offlinePlaylistSyncCheck fetch request error",b);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:M=Rc(d);if(!d)throw d9("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(M!==void 0)ew(M,"playlist sync");else if(!d.offlinePlaylistSyncCheckDatas||!d.offlinePlaylistSyncCheckDatas.length)throw d9("No data for playlist sync"),Error("No data for playlist sync");return V.return(d.offlinePlaylistSyncCheckDatas.map(function(A){return A.offlinePlaylistSyncCheckData}))}})},Ew=function(v){this.Y=v},DfN=function(v,O){var Y,S,d,r,b,z;
return g.B(function(M){switch(M.U){case 1:Y=new Map,S=g.y(O),d=S.next();case 2:if(d.done){M.d8(4);break}r=d.value;b=Y;z=b.set;return g.E(M,v.U(r),5);case 5:z.call(b,r,M.Y);d=S.next();M.d8(2);break;case 4:return M.return(Y)}})},Q0=function(v,O,Y,S,d,r){O=g.zh(O,Y);
S=Object.assign({},r,{priority:S,retryScheduleIntervalsInSeconds:d});return{actionType:v,entityKey:O,actionMetadata:S}},L1=function(v,O,Y,S,d,r){this.status=v;
this.Y=O;this.B=Y;this.U=S;this.G=d;this.downloadState=r},HBJ=function(v,O,Y){this.Y=v;
this.Yg=O;this.G=Y},O7K=function(v,O){var Y,S,d,r,b,z,M,V,A;
return g.B(function(f){switch(f.U){case 1:return Y=O.entityKey,d=(S=g.q(O.actionMetadata,B9))==null?void 0:S.isEnqueuedForExpiredStreamUrlRefetch,g.cm(f,2),r=void 0,g.E(f,NAY(v,O),4);case 4:r=f.Y;g.cm(f,5);var k=(k=g.q(O.actionMetadata,B9))?{maximumDownloadQuality:k.maximumDownloadQuality}:void 0;return g.E(f,mfN(Y,v.Yg,{isEnqueuedForExpiredStreamUrlRefetch:d,uE:k,offlineSourceData:r}),7);case 7:b=f.Y;g.ai(f,6,2);break;case 5:return g.Tc(f,2),z=z0(O)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",d9("PDE handleAdd error"),f.return(Zw(O,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",z,"DOWNLOAD_STATE_FAILED"));case 6:return g.E(f,vt8(v,b,O),8);case 8:return f.return(Zw(O,!0,b.orchestrationActions));case 2:return M=g.Tc(f),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.$d&&M.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d9("PDE handleAdd error"),f.return(Zw(O,!1,void 0,V,A,"DOWNLOAD_STATE_FAILED"))}})},dAt=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF;
return g.B(function(N){switch(N.U){case 1:return Y=O.entityKey,S=g.We(Y).entityId,g.E(N,tH(v.Y,{mode:"readonly",vT:!0},function(j1){var D=nk(j1,Y,"playbackData"),yd=nk(j1,g.zh(S,"offlineVideoPolicy"),"offlineVideoPolicy");j1=nk(j1,g.zh(S,"transfer"),"transfer");return g.az.all([D,yd,j1])}),2);
case 2:d=N.Y;r=g.y(d);b=r.next().value;z=r.next().value;M=r.next().value;V=b;A=z;f=M;if(!V||!A)return N.return(Zw(O,!0));k=[];a=((c=V)==null?0:c.playerResponseJson)?JSON.parse(V.playerResponseJson):null;if(!(f&&a&&v.Yg.V("html5_refresh_deprecated_downloads"))){N.d8(3);break}U=YSw(v,a,f);return g.E(N,SSt(v,f),4);case 4:k=N.Y;case 3:x={lastPlayerResponseTimestampSeconds:V.playerResponseTimestamp,offlineToken:A.offlineToken,formatIds:k};T={};if((l=f)==null?0:l.maximumDownloadQuality)T.maximumDownloadQuality=
f.maximumDownloadQuality;g.cm(N,5);Q=void 0;return g.E(N,NAY(v,O),7);case 7:return Q=N.Y,g.cm(N,8),g.E(N,mfN(Y,v.Yg,{refreshData:x,uE:T,offlineSourceData:Q,mediaCapabilities:U}),10);case 10:L=N.Y;g.ai(N,9,5);break;case 8:return g.Tc(N,5),I=z0(O)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",d9("PDE handleRefresh error"),N.return(Zw(O,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",I,"DOWNLOAD_STATE_FAILED"));
case 9:return g.E(N,vt8(v,L,O),11);case 11:return N.return(Zw(O,!0,L.orchestrationActions));case 5:return t=g.Tc(N),P="PDE handleRefresh error",t instanceof Error&&(P="PDE handleRefresh error: "+t.message),YQ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",dF="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.$d&&t.type==="QUOTA_EXCEEDED"&&(YQ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",dF="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),d9(P),N.return(Zw(O,
!1,void 0,YQ,dF,"DOWNLOAD_STATE_FAILED"))}})},NAY=function(v,O){var Y,S,d,r;
return g.B(function(b){if(b.U==1)return Y=g.We(O.entityKey).entityId,S=g.zh(Y,"videoDownloadContextEntity"),g.E(b,HF(v.Y,S,"videoDownloadContextEntity"),2);d=b.Y;return(r=d)!=null&&r.offlineModeType?b.return({offlineModeType:d.offlineModeType}):b.return(void 0)})},vt8=function(v,O,Y){var S,d,r,b,z;
return g.B(function(M){if(M.U==1){if(!O.frameworkUpdates||!g.q(O.frameworkUpdates,xq))return M.return();if(!(g.q(O.frameworkUpdates,xq).mutations&&g.q(O.frameworkUpdates,xq).mutations.length>0&&g.q(O.frameworkUpdates,xq).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return M.d8(2);S=g.We(g.q(O.frameworkUpdates,xq).mutations[0].entityKey).entityId;return g.E(M,p1(v.Y,S),3)}if(M.U!=2){d=M.Y;r=g.q(Y.actionMetadata,B9);if(z=(b=r)==null?void 0:b.playlistId)d.playlistId=z;d.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.PD(v.Yg)?g.E(M,ac(S,v.Y,Y,v.G,d),2):g.qB(v.Yg)?g.E(M,T0(S,v.Y,Y,v.G),2):M.d8(2)}return g.E(M,ptY(g.q(O.frameworkUpdates,xq)),0)})},Zw=function(v,O,Y,S,d,r){return new L1(O?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z0(v),Y,S,d,r)},YSw=function(v,O,Y){O=sSJ(v.Yg,Y.cotn,O);
Y=g.YL(O);return g.HAn(O,Y,v.Yg)},SSt=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k;
return g.B(function(U){if(U.U==1)return Y=[],g.E(U,tH(v.Y,{mode:"readonly",vT:!0},function(c){var a=[],x=O.offlineVideoStreams;if(x){x=g.y(x);for(var T=x.next();!T.done;T=x.next())a.push(nk(c,T.value,"offlineVideoStreams"))}return g.az.all(a)}),2);
if(S=U.Y)for(d=g.y(S),r=d.next();!r.done;r=d.next())if(b=r.value,z=void 0,(z=b)==null?0:z.streamsProgress)for(M=b.streamsProgress,V=0;V<M.length;V++)A=M[V],f=JSON.parse(A.formatStreamBytes),k={itag:f.itag,lmt:f.lastModified,xtags:f.xtags},Y.push(k);return U.return(Y)})},rBS=function(v,O){this.Y=v;
this.Yg=O},b7N=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U;
return g.B(function(c){switch(c.U){case 1:return Y=z0(O),g.E(c,NT(v.Y,"videoPlaybackPositionEntity"),2);case 2:S=c.Y;if(S.length===0)return c.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.cm(c,3);return g.E(c,wm.getInstance(),5);case 5:d=c.Y;if(!d)throw Error("prefStorage is undefined");return g.E(c,d.get("psi"),6);case 6:return r=c.Y,M=(z=(b=r)==null?void 0:b.fO)!=null?z:"0",g.E(c,G_S(S,M),7);case 7:return V=c.Y,A={isPaused:V.watchHistoryPaused,fO:V.syncTimestampUsec},g.E(c,d.set("psi",
A),8);case 8:if(A.isPaused){c.d8(9);break}f=g.q(V.frameworkUpdates,xq);if(!V.frameworkUpdates||!f){c.d8(9);break}return g.E(c,ptY(f),9);case 9:g.ai(c,4);break;case 3:return k=g.Tc(c),U="PPE handleRefresh error: "+(k instanceof Error?k.message:"unknown error"),d9(U),c.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},j6L=function(v,O){var Y,S,d,r,b,z,M,V;
return g.B(function(A){switch(A.U){case 1:return Y=z0(O),S=g.We(O.entityKey).entityId,g.cm(A,2),g.E(A,wm.getInstance(),4);case 4:d=A.Y;if(!d)throw Error("prefStorage is undefined");return g.E(A,d.get("psi"),5);case 5:r=A.Y;b=g.q(O.actionMetadata,otC);if(((z=r)==null?void 0:z.isPaused)!==!1||(M=b)==null||!M.lastPlaybackPositionSeconds){A.d8(6);break}V={key:g.zh(S,"videoPlaybackPositionEntity"),videoId:S,lastPlaybackPositionSeconds:b.lastPlaybackPositionSeconds};return g.E(A,D7(v.Y,V,"videoPlaybackPositionEntity"),
6);case 6:g.ai(A,3);break;case 2:return g.Tc(A),A.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},WXt=function(v,O){var Y,S,d;
return g.B(function(r){switch(r.U){case 1:Y=z0(O);g.cm(r,2);S=g.We(O.entityKey).entityId;if(S==="!*$_ALL_ENTITIES_!*$")return g.E(r,unU(v.Y),5);d=g.zh(S,"videoPlaybackPositionEntity");return g.E(r,cdL(v.Y,d),5);case 5:g.ai(r,3);break;case 2:return g.Tc(r),r.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},zXt=function(v,O){this.api=v;
this.Y=O;this.logger=new g.vY("woffle");this.U=!1;this.Qg={Vf:this.Vf};this.logger.debug("Initialized OfflineMediaManager")},s6Y=function(v){return g.B(function(O){return O.return(E_U(v))})},gtv=function(v){var O;
return g.B(function(Y){if(Y.U==1)return g.E(Y,g.Uc3(v),2);O=Y.Y;return Y.return(O.filter(function(S){return!!S.url}).map(function(S){return S.url}))})},X1=function(v,O){var Y=g.xf(O);
if(Y===1||Y===0)return Promise.resolve();(Y=Ms8(v,O))&&Y.stopVideo();v.G=0;return s6Y(O)},w9=function(v,O,Y,S){Y=Y===void 0?!1:Y;
S=S===void 0?!0:S;var d=typeof O==="string"?O:O.videoDetails.videoId;g.xf(d)===2&&((O=Ms8(v,d))?O.stopVideo():v.logger.info(function(){return"Corresponding player for "+d+" not found. Pausing anyway"}),g.pm(d,2),v.G=2,Y?Vs8(v.Y):S&&ABw(v.Y))},Ms8=function(v,O){var Y;
return((Y=v.player)==null?void 0:Y.getVideoData().videoId)===O?v.player:null},fOY=function(v,O,Y){O.getPlayerResponse();
g.pm(O.videoId,2);v.G=2;v.U=!1;var S;(S=v.player)==null||S.dispose();v.player=v.api.Bf(O);O={};v.player.pU((O.localmediachange=v.N_,O.signatureexpired=v.rF,O.statechange=v.Vh4,O),v);var d=v.Vf(Y);v.player.X8(g.bB(d,d,!0,"m"),!1);v.logger.debug(function(){return"Starting headless playback with quality: "+d});
v.player.Ie(!1)},$AC=function(v,O){this.Y=v;
this.Yg=O},UAt=function(v,O){var Y,S;
return g.B(function(d){switch(d.U){case 1:return Y=z0(O),g.E(d,HF(v.Y,O.entityKey,"transfer"),2);case 2:if(S=d.Y)return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.cm(d,3);return g.E(d,kVt(v,O),5);case 5:g.ai(d,4);break;case 3:return g.Tc(d),d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},cBN=function(v,O){var Y,S;
return g.B(function(d){switch(d.U){case 1:return Y=z0(O),g.E(d,HF(v.Y,O.entityKey,"transfer"),2);case 2:S=d.Y;if(!S||S.transferState!=="TRANSFER_STATE_COMPLETE")return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.cm(d,3);return g.E(d,kVt(v,O,!0),5);case 5:g.ai(d,4);break;case 3:return g.Tc(d),d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},uHN=function(v,O){var Y,S,d,r,b,z,M,V,A,f;
return g.B(function(k){switch(k.U){case 1:return Y=z0(O),S=g.We(O.entityKey).entityId,g.E(k,tH(v.Y,{mode:"readonly",vT:!0},function(U){var c=nk(U,O.entityKey,"transfer");U=nk(U,g.zh(S,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.az.all([c,U])}),2);
case 2:d=k.Y;r=g.y(d);b=r.next().value;z=r.next().value;M=b;V=z;if(!M||M.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return k.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.cm(k,3);M.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.E(k,D7(v.Y,M,"transfer"),5);case 5:A=g.We(M.key).entityId;rUL({videoId:A,py:M,offlineModeType:(f=V)==null?void 0:f.offlineModeType});g.ai(k,4);break;case 3:return g.Tc(k),k.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},kVt=function(v,O,Y){Y=Y===void 0?!1:Y;
var S,d,r,b,z,M,V,A,f,k,U,c,a,x,T;return g.B(function(l){switch(l.U){case 1:return S=g.q(O.actionMetadata,CpN),d=g.We(O.entityKey).entityId,r=g.zh(d,"downloadStatusEntity"),g.E(l,tH(v.Y,{mode:"readonly",vT:!0},function(Q){var L=nk(Q,r,"downloadStatusEntity");Q=nk(Q,g.zh(d,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.az.all([L,Q])}),2);
case 2:return b=l.Y,z=g.y(b),M=z.next().value,V=z.next().value,A=M,f=V,k="TRANSFER_STATE_TRANSFER_IN_QUEUE",((U=A)==null?void 0:U.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(k="TRANSFER_STATE_PAUSED_BY_USER"),x={key:O.entityKey,transferState:k,cotn:g.a7(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(c=S)==null?void 0:c.maximumDownloadQuality,preferredAudioTrack:(a=S)==null?void 0:a.preferredAudioTrack,transferRetryCount:0,isRefresh:Y,hasLoggedFirstStarted:!1},g.E(l,tH(v.Y,
{mode:"readwrite",vT:!0},function(Q){var L=[];Y&&L.push(Gl(Q,g.zh(d,"offlineVideoStreams")));L.push(PF(Q,x,"transfer"));return g.az.all(L)}),3);
case 3:if(!Y){l.d8(4);break}return g.E(l,s6Y(d),4);case 4:SCU({videoId:d,py:x,offlineModeType:(T=f)==null?void 0:T.offlineModeType}),g.UE(l)}})},aOK=function(v,O,Y,S){if(!v.action.entityKey)throw Error("entityKey is missing.");
var d=g.We(v.action.entityKey);d={entityType:d.xS,entityId:d.entityId,offlineOrchestrationActionType:v.action.actionType,orchestrationAction:{orchestrationActionId:v.actionId}};O&&(d.offlineOrchestrationActionResult=O.status,d.isRetryable=Y?!1:O.Y,O.G&&(d.offlineOrchestrationFailureReason=yBv(O.G,d.isRetryable)));var r,b;if((r=v.action.actionMetadata)==null?0:(b=r.offlineLoggingData)==null?0:b.offlineModeType)d.offlineModeType=v.action.actionMetadata.offlineLoggingData.offlineModeType;S&&(d.additionalOrchestrationActions=
S.map(function(z){return{orchestrationActionId:z.actionId}}));
return d},yBv=function(v,O){return v!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||O?v==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&O?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":v:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},xAY=function(v,O){var Y={offlineOrchestrationContext:aOK(v)};
O=I4N(O,Y);qWU(wtw(),O,v.rootActionId)},pML=function(v,O,Y,S){S=S===void 0?[]:S;
O={offlineOrchestrationContext:aOK(v,O,Y,S)};O=I4N(3,O);qWU(wtw(),O,v.rootActionId)},TkJ=function(){this.actions=[]},lON=function(v,O){O=g.y(O);
for(var Y=O.next();!Y.done;Y=O.next())Y=Y.value,xAY(Y,1),v.actions.push(Y);v.actions.sort(v.Y)},FXY=function(v,O){if(O)for(var Y=0;Y<v.actions.length;Y++)if(O==="!*$_ALL_ENTITIES_!*$"&&v.actions[Y].actionId!==O||O!=="!*$_ALL_ENTITIES_!*$"&&v.actions[Y].rootActionId===O&&v.actions[Y].actionId!==O)v.actions.splice(Y,1),Y--},hXJ=function(v,O){v=g.y(v.actions);
for(var Y=v.next();!Y.done;Y=v.next())if(Y.value.actionId===O)return!0;return!1},Ic=function(v,O,Y,S,d){g.X.call(this);
var r=this;this.U=v;this.HW=O;this.tK=Y;this.L=S;this.Yg=d;this.Y=new TkJ;this.C=new g.iA;this.G=new g.mX(function(){r.retry()});
this.X=NaN;this.Z=!1;this.Qg={W2g:function(){return r.Y},
aG:function(){return r.C},
qZ1:function(){return r.G},
retry:function(){return r.retry()}};
g.w(this,this.G);this.j=this.U.observe(this.Ug.bind(this))},Etv=function(v,O,Y,S,d){var r;
return g.B(function(b){if(b.U==1)return r=new Ic(v,O,Y,S,d),g.E(b,RXS(r),2);eX0(r);return b.return(r)})},eX0=function(v){var O=v.Y.actions[0];
return v.B?((O==null?void 0:O.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&v.B[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(v.Z=!0),Promise.resolve()):Q6N(v)},Q6N=function(v){var O,Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T;
return g.B(function(l){switch(l.U){case 1:if(v.B)throw Error("Already processing an action");if(v.vW())return l.return();O=v.Y.actions.shift();OBN(v.tK,!O);if(O===void 0)return l.return();O.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&O.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&FXY(v.Y,O.actionId);Y="";O.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&O.rootActionId===O.actionId&&(Y=O.actionId);S=[O];v.B=S;if(d=v.HW[O.entityType]){l.d8(2);break}v.B=
void 0;return g.E(l,Q6N(v),3);case 3:return l.return();case 2:r=g.y(S);for(b=r.next();!b.done;b=r.next())z=b.value,xAY(z,2);g.cm(l,4,5);return g.E(l,DfN(d,S.map(function(Q){return Q.action})),7);
case 7:M=l.Y,V=g.y(S),A=V.next();case 8:if(A.done){l.d8(10);break}f=A.value;k=M.get(f.action);return g.E(l,LXS(v,f,k),9);case 9:A=V.next();l.d8(8);break;case 10:FXY(v.Y,Y);case 5:g.Fw(l);v.B=void 0;g.Ri(l,6);break;case 4:return U=g.Tc(l),d9("Orchestration error",U),g.cm(l,12),g.E(l,BkJ(v,S),14);case 14:g.ai(l,5);break;case 12:c=g.Tc(l);d9("Orchestration retry error",c);a=g.y(S);for(x=a.next();!x.done;x=a.next())T=x.value,T.retryScheduleIndex<3&&lON(v.Y,[T]);l.d8(5);break;case 6:return g.E(l,Q6N(v),
0)}})},LXS=function(v,O,Y){var S,d,r,b,z,M,V,A,f,k,U,c;
return g.B(function(a){switch(a.U){case 1:S=O.retryScheduleIndex+2===3;if(Y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){a.d8(2);break}if(Y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){a.d8(0);break}pML(O,Y,S);if(Y.Y&&O.retryScheduleIndex+1<3)return g.E(a,BkJ(v,[O]),0);r=((d=Y)==null?0:d.U)?Y.U:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";b={entityKey:O.action.entityKey,failureReason:r};z=void 0;g.PD(v.Yg)?z="mainVideoDownloadStateEntity":g.qB(v.Yg)&&(z="musicTrackDownloadMetadataEntity");
if(!z||!Y.downloadState){a.d8(7);break}M=g.We(O.action.entityKey).entityId;return g.E(a,AD(M,z,v.U,Y.downloadState),7);case 7:bD(v.L,b);if(Y.downloadState==="DOWNLOAD_STATE_FAILED"&&v.Yg.V("html5_auto_retry_failed_pde_actions")){a.d8(0);break}d9("Orchestration result is not retryable, deleting action");return g.E(a,cdL(v.U,uD(O).key),0);case 2:V=void 0;try{V=(A=Y.B)==null?void 0:A.map(function(x){return v.createAction(x,O)})}catch(x){return pML(O,Y,S),f={entityKey:O.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},bD(v.L,f),d9("Orchestration subactions creation error",x),a.return()}pML(O,Y,S,V);if(!V){a.d8(12);break}k=V.map(function(x){return uD(x)});
U=0;case 13:if(!(U<V.length)||v.Z){a.d8(15);break}return g.E(a,tH(v.U,{mode:"readwrite",vT:!0},function(x){var T=[];T.push(zEw(x,k.slice(U,U+10),"offlineOrchestrationActionWrapperEntity"));return g.az.all(T)}),16);
case 16:U+=10;a.d8(13);break;case 15:if(v.Z)return v.Z=!1,a.return();case 12:return c=uD(O),g.E(a,cdL(v.U,c.key),17);case 17:xAY(O,4),g.UE(a)}})},IOJ=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U;
return g.B(function(c){Y=[];S=Infinity;d=4E3;r=g.y(O);for(b=r.next();!b.done;b=r.next())z=b.value,M=Number(z.enqueueTimeSec),V=Z7U(M),A=z.retryScheduleIndex,f=A!=null&&A>0,V>0&&f?(S=Math.min(S,M),d=Math.min(V,d)):Y.push(z);isFinite(S)&&(!v.G.isActive()||S<v.X)&&(v.X=S,v.G.start(d));v.C.hE()||(k=Y.length,Y=Y.filter(function(a){var x;a=((x=a.actionProto)==null?void 0:x.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!XMY.includes(a)}),U=Y.length<k,!v.G.isActive()&&U&&v.G.start(1));
Y.length>0&&wMN(v,Y);return g.E(c,eX0(v),0)})},ntY=function(v){var O,Y,S,d,r,b,z;
return g.B(function(M){if(M.U==1)return g.E(M,qSJ(v),2);O=M.Y;Y=[];S=g.y(O);for(d=S.next();!d.done;d=S.next())r=d.value,b=g.We(r.key),z=b.entityId,hXJ(v.Y,z)||Y.push(r);return g.E(M,IOJ(v,Y),0)})},Z7U=function(v){v=v*1E3-Date.now();
return v>4E3?4E3:v},BkJ=function(v,O){var Y,S,d;
return g.B(function(r){Y=g.y(O);for(S=Y.next();!S.done;S=Y.next()){d=S.value;var b=void 0,z=void 0,M=((z=d.action)==null?void 0:(b=z.actionMetadata)==null?void 0:b.retryScheduleIntervalsInSeconds)||[1,2,4];b=1;d.retryScheduleIndex<M.length&&(b=M[d.retryScheduleIndex]);d.Y=b*1E3+Date.now();d.retryScheduleIndex++}return g.E(r,JBC(v,O),0)})},RXS=function(v){var O;
return g.B(function(Y){if(Y.U==1)return g.E(Y,NT(v.U,"offlineOrchestrationActionWrapperEntity"),2);O=Y.Y;return g.E(Y,IOJ(v,O),0)})},wMN=function(v,O){O.length!==0&&O.forEach(function(Y){Y=c9(Y);
Y.retryScheduleIndex<3&&lON(v.Y,[Y])})},qSJ=function(v,O){var Y;
return g.B(function(S){if(S.U==1)return g.E(S,NT(v.U,"offlineOrchestrationActionWrapperEntity",O),2);Y=S.Y;return S.return(Y.filter(T10))})},JBC=function(v,O){if(O.length===0)return Promise.resolve([]);
O=O.map(function(Y){return uD(Y)});
return Ud8(v.U,O)},KX0=function(v){this.r8=v;
this.Y=void 0},PpK=function(v,O){var Y,S,d,r;
return g.B(function(b){Y=O.videoId;S=!0;if(O.captionTracks.length)d=b5C(O),v.Y=new g.AM(v.r8,O,d);else if(O.FZ)r=g.F53(O),v.Y=new g.$h(v.r8,O.FZ,Y,r,O.JS,O.eventId),S=O.JS;else return b.return();return b.return(new Promise(function(z){var M;(M=v.Y)==null||M.vy({xb:function(){return g.B(function(V){if(V.U==1)return g.E(V,v.xb(Y,S),2);z();g.UE(V)})},
Kz:function(){}})}))})},GVN=function(v){var O;
return g.B(function(Y){if(Y.U==1)return g.E(Y,eEN(v),2);O=Y.Y;return Y.return(!!O&&O.length>0)})},qp=function(v){g.X.call(this);
this.Y=v;this.U=this.Y.observe(this.G.bind(this))},i78=function(v,O){var Y,S,d,r,b,z,M;
return g.B(function(V){switch(V.U){case 1:if(O.length===0)return V.return([]);Y=O.map(function(A){return g.zh(A,"transfer")});
return g.E(V,NT(v.Y,"transfer",Y),2);case 2:S=V.Y;d=S.filter(T10).map(function(A){return g.We(A.key).entityId});
r=O.filter(function(A){return d.indexOf(A)===-1});
if(r.length===0)return V.return([]);b=g.y(r);z=b.next();case 3:if(z.done){V.d8(5);break}M=z.value;return g.E(V,s6Y(M),4);case 4:z=b.next();V.d8(3);break;case 5:return V.return(r)}})},DAK=function(v,O,Y,S,d,r){var b,z,M;
return g.B(function(V){b="STREAM_TYPE_UNKNOWN";Y.video&&Y.audio?(b="STREAM_TYPE_AUDIO_AND_VIDEO",d9("unexpected stream type")):Y.video&&!Y.audio?b="STREAM_TYPE_VIDEO":!Y.video&&Y.audio&&(b="STREAM_TYPE_AUDIO");z=g.zh(O,"offlineVideoStreams");M={numBytesDownloaded:d.toFixed(),numTotalBytes:r.toFixed(),streamType:b,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(S),itag:b==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(Y.itag):void 0};return g.E(V,tH(v,{mode:"readwrite",vT:!0},
function(A){var f=nk(A,z,"offlineVideoStreams"),k=nk(A,g.zh(O,"transfer"),"transfer");return g.az.all([f,k]).then(function(U){U=g.y(U);var c=U.next().value;U=U.next().value;if(!U)return Gl(A,z).then(function(){});
var a=mAN(c);c=tsN(c,S,M,z);var x=PF(A,c,"offlineVideoStreams");mAN(c)>a&&(U.lastProgressTimeMs=Date.now().toString());a=[x];U.offlineVideoStreams||(U.offlineVideoStreams=[]);U.offlineVideoStreams.indexOf(z)===-1&&(U.offlineVideoStreams.push(z),a.push(PF(A,U,"transfer")));return g.az.all(a)})}),0)})},H7v=function(v,O){var Y,S,d,r,b;
return g.B(function(z){if(z.U==1)return Y=g.zh(O,"offlineVideoStreams"),g.E(z,HF(v,Y,"offlineVideoStreams"),2);S=z.Y;if(!S||!S.streamsProgress)return z.return();d=g.y(S.streamsProgress);for(r=d.next();!r.done;r=d.next())b=r.value,b.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",b.numTotalBytes!==b.numBytesDownloaded&&(b.numBytesDownloaded=b.numTotalBytes);return g.E(z,D7(v,S,"offlineVideoStreams"),0)})},tsN=function(v,O,Y,S){if(v&&v.streamsProgress){S=v;
a:{O=O.itag+";"+O.xtags;for(var d=v.streamsProgress,r=0;r<d.length;r++){var b=JSON.parse(d[r].formatStreamBytes);if(b.itag+";"+b.xtags===O){d[r]=Y;Y=d;break a}}d.push(Y);Y=d}S.streamsProgress=Y}else v={key:S,streamsProgress:[Y]};return v},mAN=function(v){if(v==null?0:v.streamsProgress){var O=0;
v=v.streamsProgress;for(var Y=0;Y<v.length;Y++){var S=v[Y];isNaN(Number(S.numBytesDownloaded))?d9("stream progress bytes number invalid"):O+=Number(S.numBytesDownloaded)}return O}return 0},NkN=function(v,O,Y,S){g.X.call(this);
var d=this;this.U=v;this.api=O;this.XO=Y;this.Ug=S;this.C=new g.iA;this.B=new g.mX(function(){d.Y&&d.Y.transferState==="TRANSFER_STATE_TRANSFERRING"&&d.C.hE()&&((d.Y.transferRetryCount||0)<3?w9(d.L,d.Z,!1,!1):X1(d.L,d.Z.videoDetails.videoId),d.nh("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.tK=this.N3=0;this.j=this.X=!1;this.f1=g.Vq(this.api.D().experiments,"html5_transfer_processing_logs_interval");this.AK=new g.Z6(this);this.Qg={azd:function(){return d.B},
ZMx:function(){return d.Ug},
aG:function(){return d.C}};
this.HW=this.U.observe(this.Ou.bind(this));this.L=new zXt(O,this);this.Eg=new KX0(O);this.JK=new qp(this.U);this.g8=this.C.listen("publicytnetworkstatus-online",this.Jv.bind(this));this.FO=this.C.listen("publicytnetworkstatus-offline",this.zm8.bind(this));this.j=this.api.D().V("html5_less_transfer_processing_logs");g.w(this,this.AK);this.AK.S(O,"offlinetransferpause",this.n41);g.PD(this.api.D())?this.G="mainVideoDownloadStateEntity":g.qB(this.api.D())&&(this.G="musicTrackDownloadMetadataEntity")},
vGU=function(v){return g.B(function(O){if(O.U==1)O=g.E(O,hEN(),2);
else{var Y=v.JK;var S=g.aJ();S=Object.keys(S);Y=i78(Y,S);O=g.E(O,Y,0)}return O})},JD=function(v,O){O=O===void 0?!1:O;
var Y;return g.B(function(S){if(S.U==1){if(v.Y)throw Error("Already downloading a video");v.tK=0;v.X=!1;return g.E(S,OOC(v),2)}return S.U!=4?(Y=S.Y,YCJ(v.XO,!Y),Y&&v.C.hE()?O?g.E(S,new Promise(function(d){g.fS(d,1E3)}),4):S.d8(4):(!Y&&v.Y&&n1(v),S.d8(0))):g.E(S,YsN(v,Y),0)})},Ss0=function(v){return g.B(function(O){if(O.U==1)return v.Z?g.E(O,X1(v.L,v.Z.videoDetails.videoId),3):O.d8(0);
n1(v);g.UE(O)})},dMC=function(v,O){var Y,S,d;
return g.B(function(r){switch(r.U){case 1:return g.cm(r,2),(Y=!!O.captionTracks.length||!!O.FZ)?g.E(r,GVN(O.videoId),4):r.return();case 4:return(S=r.Y)?r.return():g.E(r,PpK(v.Eg,O),5);case 5:g.ai(r,0);break;case 2:d=g.Tc(r),d9("Caption downloading error",d,O.cotn),g.UE(r)}})},YsN=function(v,O){var Y,S,d,r,b,z;
return g.B(function(M){switch(M.U){case 1:if(v.X)return M.return();v.X=!0;v.Y=O;Y=g.We(v.Y.key);S=Y.entityId;d=void 0;if(v.Y.transferState==="TRANSFER_STATE_TRANSFERRING")return g.E(M,K1(v,S),7);if(v.Y.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||v.Y.transferRetryCount||v.Y.hasLoggedFirstStarted){M.d8(3);break}return g.E(M,K1(v,S),5);case 5:return d=M.Y,v.Y.hasLoggedFirstStarted=!0,g.E(M,rSt(v),6);case 6:dfY({videoId:S,py:v.Y,offlineModeType:d},void 0,void 0,!0);M.d8(3);break;case 7:d=M.Y,
W9({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:S,py:v.Y,offlineModeType:d});case 3:return g.E(M,bO8(v),8);case 8:return r=null,g.cm(M,9),g.E(M,oGJ(v,O),11);case 11:r=M.Y;v.Z=r;g.ai(M,10);break;case 9:return b=g.Tc(M),d9("error getting player response",b,O.cotn),g.E(M,v.nh("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return M.return();case 10:return z=sSJ(v.api.D(),O.cotn,r),g.E(M,dMC(v,z),13);case 13:return g.E(M,gtv(z.videoId),
14);case 14:z.Ma=M.Y,fOY(v.L,z,O.maximumDownloadQuality),v.B.start(108E5),g.UE(M)}})},OOC=function(v){var O,Y;
return g.B(function(S){if(S.U==1)return g.E(S,NT(v.U,"transfer"),2);O=S.Y;Y=O.filter(jnS).sort(WpL);return Y.length===0?S.return():S.return(Y[0])})},bO8=function(v){var O,Y,S;
return g.B(function(d){if(d.U==1){if(!v.Y)return P9(v,"onTransferStart"),d.return();v.B.start(108E5);return g.E(d,G0(v,"TRANSFER_STATE_TRANSFERRING"),2)}O=v.Y;return(S=((Y=O)==null?0:Y.key)?g.We(O.key).entityId:"")&&v.G?g.E(d,AD(S,v.G,v.U,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):d.d8(0)})},Vs8=function(v){var O,Y,S,d;
g.B(function(r){switch(r.U){case 1:if(!v.Y){P9(v,"onTransferPausedByUser");r.d8(2);break}O=v.Y;v.B.stop();return g.E(r,G0(v,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:S=((Y=O)==null?0:Y.key)?g.We(O.key).entityId:"";if(!S||!v.G){r.d8(4);break}return g.E(r,AD(S,v.G,v.U,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.E(r,K1(v,S),6);case 6:d=r.Y,bBL({videoId:S,py:O,offlineModeType:d});case 2:n1(v),JD(v),g.UE(r)}})},ABw=function(v){var O,Y,S;
g.B(function(d){if(d.U==1){if(!v.Y)return P9(v,"onTransferPausedByNetwork"),d.return();v.B.stop();return g.E(d,G0(v,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(d.U!=3)return O=v.Y,(S=((Y=O)==null?0:Y.key)?g.We(O.key).entityId:"")&&v.G?g.E(d,AD(S,v.G,v.U,"DOWNLOAD_STATE_PAUSED"),3):d.d8(3);n1(v);g.UE(d)})},zdU=function(v){var O,Y,S,d,r;
g.B(function(b){switch(b.U){case 1:if(!v.Y)return P9(v,"onTransferComplete"),b.return();O=v.Y;v.B.stop();if(!O||!v.Z){b.d8(2);break}Y=sSJ(v.api.D(),O.cotn,v.Z);return g.E(b,dMC(v,Y),2);case 2:return g.E(b,G0(v,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:d=((S=O)==null?0:S.key)?g.We(O.key).entityId:"";if(!d||!v.G){b.d8(5);break}return g.E(b,AD(d,v.G,v.U,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.E(b,H7v(v.U,d),7);case 7:return g.E(b,K1(v,d),8);case 8:r=b.Y,W9({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:d,py:O,offlineModeType:r}),n1(v),JD(v),g.UE(b)}})},sn8=function(v,O,Y){var S,d;
g.B(function(r){switch(r.U){case 1:if(!v.Y)return P9(v,"onTransferProgress: "+O),r.return();if(v.Y.transferState==="TRANSFER_STATE_TRANSFERRING"){r.d8(2);break}return g.E(r,bO8(v),2);case 2:S=Date.now();if(!(S-v.N3>1E3)){r.d8(4);break}v.N3=S;return g.E(r,DAK(v.U,Y.videoId,Y.U,Y.MJ,Y.bytesDownloaded,Y.Y),5);case 5:if(v.j&&!(v.j&&S-v.tK>v.f1)){r.d8(4);break}v.tK=S;return g.E(r,K1(v,O),7);case 7:d=r.Y,dfY({videoId:O,py:v.Y,offlineModeType:d},Y.bytesDownloaded,Y.Y);case 4:v.B.start(108E5),g.UE(r)}})},
gGS=function(v){var O=(v.Y.transferRetryCount||0)<3;
O&&(v=v.Y,v.transferRetryCount=(v.transferRetryCount||0)+1);return O},MiN=function(v,O){O=O===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":O;
var Y,S,d,r;return g.B(function(b){if(b.U==1)return v.Y||P9(v,"setTransferToFailed: "+O),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O==="TRANSFER_FAILURE_REASON_NETWORK"?Y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":O==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.E(b,G0(v,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",O),2);if(b.U!=3)return bD(v.Ug,{entityKey:(S=v.Y)==null?void 0:S.key,failureReason:Y}),
d=v.Y?g.We(v.Y.key).entityId:"",g.E(b,K1(v,d),3);r=b.Y;var z={videoId:d,py:v.Y,offlineModeType:r},M=O,V={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};M&&(V.transferFailureReason=M,V.failureReason=oH0(M));W9(V,z);g.UE(b)})},G0=function(v,O,Y,S){var d;
return g.B(function(r){if(r.U==1){if(!v.Y)return P9(v,"saveTransferState: "+O),r.return();v.Y.transferState=O;v.Y.failureReason=S;g.cm(r,2);return g.E(r,rSt(v,function(b){return Y?JH(b,"offlineVideoStreams",v.Y.offlineVideoStreams).then(function(z){for(var M=g.y(z),V=M.next();!V.done;V=M.next())if((V=V.value)&&V.streamsProgress){V=g.y(V.streamsProgress);for(var A=V.next();!A.done;A=V.next())A.value.streamState=Y}return zEw(b,z.filter(function(f){return!!f}),"offlineVideoStreams")}):g.az.resolve(void 0)}),
4)}if(r.U!=2)return g.ai(r,0);
d=g.Tc(r);return d instanceof g.$d&&d.type==="QUOTA_EXCEEDED"?g.E(r,v.nh("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):r.d8(0)})},rSt=function(v,O){var Y;
return g.B(function(S){if(!v.Y)return S.return();Y=v.Y;return g.E(S,tH(v.U,{mode:"readwrite",vT:!0},function(d){var r=[PF(d,Y,"transfer")];O&&r.push(O(d));return g.az.all(r)}),0)})},n1=function(v){v.Y=void 0;
v.Z=void 0;v.B.stop()},oGJ=function(v,O){var Y,S,d,r,b;
return g.B(function(z){if(z.U==1)return Y=g.We(O.key),S=Y.entityId,d=g.zh(S,"playbackData"),g.E(z,HF(v.U,d,"playbackData"),2);r=z.Y;if((b=r)==null?0:b.playerResponseJson)return z.return(JSON.parse(r.playerResponseJson));throw Error("No PlayerResponse found");})},P9=function(v,O){v.api.G0("woffle",{mcte:O});
d9("missing current transfer entity.")},K1=function(v,O){var Y,S,d;
return g.B(function(r){if(r.U==1)return g.E(r,HF(v.U,g.zh(O,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);Y=r.Y;return r.return((d=(S=Y)==null?void 0:S.offlineModeType)!=null?d:void 0)})},jnS=function(v){return Viw[v.transferState]!==void 0},WpL=function(v,O){var Y=Viw[v.transferState],S=Viw[O.transferState];
return Y!==S?Y-S:Number(v.enqueuedTimestampMs)-Number(O.enqueuedTimestampMs)},iD=function(v,O){var Y=this;
this.Yg=v;this.api=O;this.C=new g.iA;this.Z=new g.Mf;this.Qg={uR:function(){return Y.G.Qg.uR()},
aG:function(){return Y.C},
h$s:function(){return Y.G},
v$:function(){return Y.v$()},
Rs:function(){return Y.Rs()},
xA:function(){return Y.xA()},
jV:function(){return Y.jV()},
T1:function(){return Y.T1()},
jS:function(S){return Y.jS(S)}};
this.G=new HZt(function(){return ASL(Y)},function(){Y.xA()},this.api.R4(),this.api.V.bind(this.api));
this.Y=new r9(this.api);N1w(this.G)},ASL=function(v){return g.B(function(O){v.api.PW("onOrchestrationBecameLeader");
return g.E(O,v.Rs(),0)})},$Mw=function(v){var O,Y;
return g.B(function(S){if(S.U==1)return g.E(S,v9(),2);if(S.U!=3){O=S.Y;if(!O)return d9("PES is undefined"),S.return();v.U=new NkN(O,v.api,v.G,v.Y);Y=v.Pf(O);return g.E(S,Etv(O,Y,v.G,v.Y,v.Yg),3)}v.L=S.Y;return g.E(S,flv(v),0)})},flv=function(v){var O;
return g.B(function(Y){switch(Y.U){case 1:if(!v.U)return d9("transferManager is undefined"),Y.return();if(v.U.Y){Y.d8(2);break}return g.E(Y,JD(v.U),2);case 2:if(!v.Yg.V("woffle_enable_main_downloads_library")){Y.d8(4);break}return g.E(Y,v.Tz(),4);case 4:if(!v.Yg.V("html5_offline_playback_position_sync")){Y.d8(6);break}return g.E(Y,v.Bo(),7);case 7:return g.E(Y,v.jS(864E5),6);case 6:return g.E(Y,v.refreshAllStaleEntities(43200,!0),9);case 9:return g.E(Y,v.Yh(),10);case 10:if(!v.Yg.V("html5_retry_downloads_for_expiration")){Y.d8(11);
break}return g.E(Y,v.T1(),11);case 11:return v.X=g.$c(function(){v.refreshAllStaleEntities(43200,!0);v.Yh()},9E5),g.NL(g.O8(),function(){return v.jV()}),g.E(Y,v9(),13);
case 13:return O=Y.Y,g.E(Y,DdN(O),14);case 14:vHw(v.G),g.UE(Y)}})},kfJ=function(){var v,O,Y,S,d,r;
return g.B(function(b){switch(b.U){case 1:return g.E(b,v9(),2);case 2:v=b.Y;if(!v)return b.return([]);O=Date.now()/1E3;return g.E(b,NT(v,"offlineVideoPolicy"),3);case 3:Y=b.Y,S=g.y(Y),d=S.next();case 4:if(d.done){b.d8(6);break}r=d.value;if(!(r.expirationTimestamp&&Number(r.expirationTimestamp)<O)){b.d8(5);break}r.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";r.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.E(b,D7(v,r,"offlineVideoPolicy"),5);
case 5:d=S.next();b.d8(4);break;case 6:return b.return(Y.map(function(z){return z.key}))}})},md=function(v,O,Y,S,d){var r,b,z;
return g.B(function(M){if(M.U==1)return g.E(M,v9(),2);r=M.Y;if(!r)return M.return([]);b=O.map(function(V){var A=g.zh(V,Y);A={actionType:S,entityKey:A,actionMetadata:Object.assign({},gHC(),d)};S!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(A.actionMetadata.priority=0);V=new Uw(Y,V,A);return uD(V)});
z=Ud8(r,b);N1w(v.G);return M.return(z)})},UMJ=function(v,O,Y,S){var d,r,b,z,M,V,A,f;
return g.B(function(k){switch(k.U){case 1:d=[],r=g.y(O),b=r.next();case 2:if(b.done){k.d8(4);break}z=b.value;if(z.upToDate||Y&&!z.shouldAutoSyncMetadata||!z.playlistId){k.d8(3);break}M={};switch(S){case "mainPlaylistEntity":V={nextAutoRefreshIntervalSeconds:z.checkInSeconds,autoSync:Y};M={mainPlaylistEntityActionMetadata:V};break;case "musicPlaylist":A={autoSync:Y},M={musicPlaylistEntityActionMetadata:A}}return g.E(k,md(v,[z.playlistId],S,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M),6);case 6:(f=
k.Y)&&d.push.apply(d,g.F(f));case 3:b=r.next();k.d8(2);break;case 4:return k.return(d)}})},cSY=function(v,O){var Y;
return g.B(function(S){return O.length?(Y=gHC(),g.bi(Y,B9,{isEnqueuedForExpiredStreamUrlRefetch:!0}),v.api.G0("qrd",{v:O.length}),S.return(md(v,O,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y))):S.return([])})},uGw=function(v,O,Y){this.Y=v;
this.Yg=O;this.G=Y},alL=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l;
return g.B(function(Q){switch(Q.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,r=[],g.cm(Q,2),g.E(Q,CEN(v,d),4);case 4:r=Q.Y;if(!(v.Yg.V("woffle_enable_main_downloads_library")&&((b=r)==null?0:b.length))){Q.d8(5);break}return g.E(Q,xfN(v.Y,[O.entityKey]),5);case 5:g.ai(Q,3);break;case 2:return z=g.Tc(Q),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.$d&&z.type==="QUOTA_EXCEEDED"?(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):d9("Playlist add error"),Q.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,M,V));case 3:A=[];if(!v.Yg.V("html5_offline_prevent_redownload_downloaded_video")){Q.d8(7);break}return g.E(Q,zOJ(v.Y,"mainVideoEntity",r),8);case 8:r=Q.Y;case 7:if((f=r)==null?0:f.length)for(k=g.y(r),U=k.next();!U.done;U=k.next())if(c=U.value,a=c.offlineVideoData,x=void 0,(x=a)==null?0:x.videoId)T=void 0,l=Number(((T=O.actionMetadata)==null?void 0:T.priority)||
0)+1,A.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a.videoId,"mainVideoEntity",l,tD,ySt(O,a,d)));return Q.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,A))}})},pIY=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p,oi,P0,uh,lL,AY,Xw,Qv,Ft,h,R,e,Z,n,Cn,OE,kQ,S1,h3,t3,yv,Cg,eY,G1,Gg,iM,Cx,VU,Rp,fd,e2,Pd,GA,p9,dn,mm,r3,FH,iu;
return g.B(function(As){switch(As.U){case 1:return Y=z0(O),S=O.entityKey,d=g.We(S).entityId,r=[],b=!1,d==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.E(As,NT(v.Y,"mainPlaylistEntity"),5)):g.E(As,HF(v.Y,S,"mainPlaylistEntity"),4);case 4:(z=As.Y)&&r.push(z);As.d8(3);break;case 5:r=As.Y;case 3:if((M=r)==null||!M.length)return As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));V=g.q(O.actionMetadata,xMU);f=(A=V)==null?void 0:A.nextAutoRefreshIntervalSeconds;U=(k=V)==null?void 0:k.autoSync;c=[];x=a=
!0;T=!1;if(!b&&U===!1){As.d8(6);break}g.cm(As,7);return g.E(As,wlN(0,!!U,!0,r),9);case 9:c=As.Y;g.ai(As,8);break;case 7:l=g.Tc(As);if(!(l instanceof Error&&l.message==="No data")){l instanceof Error&&l.message==="Empty response body"&&d9(l.message);As.d8(8);break}return d==="!*$_ALL_ENTITIES_!*$"?g.E(As,Uf0(v.Y,O,v.G,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.E(As,$fY(d,v.Y,O,v.G),8);case 8:if(!c.length||!b&&c[0].playlistId!==d)return As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));case 6:if(b){Q=[];L=g.y(c);for(I=L.next();!I.done;I=L.next())t=I.value,t.upToDate||U&&!t.shouldAutoSyncMetadata||!t.playlistId||(P={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:U},Q.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,tD,{mainPlaylistEntityActionMetadata:P})));return As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,Q))}c.length&&(YQ=c[0],T=!!YQ.upToDate,U&&(a=(dF=YQ.shouldAutoSyncMetadata)!=null?dF:!0,x=(N=YQ.shouldAutoSyncVideos)!=
null?N:!0,YQ.checkInSeconds&&(f=YQ.checkInSeconds)));if(T||!a)return As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));j1=[];D=r[0];if(!D.downloadState){yd=void 0;As.d8(15);break}return g.E(As,HF(v.Y,D.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:yd=As.Y;case 15:return pn=yd,uL=((Qd=pn)==null?0:Qd.addedTimestampMillis)?String(pn.addedTimestampMillis):void 0,g.cm(As,17),g.E(As,CEN(v,d,uL,f),19);case 19:j1=As.Y;g.ai(As,18);break;case 17:jU=g.Tc(As);if(!(jU instanceof
Error&&jU.message==="No data for playlist")){if(jU instanceof Error&&jU.message==="Empty response body for playlist")d9(jU.message);else return ll="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",xQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",jU instanceof g.$d&&jU.type==="QUOTA_EXCEEDED"&&(ll="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",xQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,ll,xQ));
As.d8(18);break}return g.E(As,$fY(d,v.Y,O,v.G),18);case 18:if(!x)return As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));dS=[];p=new Map;if((oi=j1)==null?0:oi.length)for(P0=g.y(j1),uh=P0.next();!uh.done;uh=P0.next())lL=uh.value,AY=lL.offlineVideoData,Xw=void 0,((Xw=AY)==null?0:Xw.videoId)&&p.set(AY.videoId,AY);Qv=new Map;Ft=[];if((h=D)==null?0:(R=h.videos)==null?0:R.length)for(e=g.y(D.videos),Z=e.next();!Z.done;Z=e.next())if(n=Z.value,Cn=JSON.parse(g.We(n).entityId),OE=Cn.videoId)p.has(OE)?
(Qv.set(OE,p.get(OE)),p.delete(OE)):Ft.push(OE);S1=Number(((kQ=O.actionMetadata)==null?void 0:kQ.priority)||0)+1;h3=g.y(p.entries());for(t3=h3.next();!t3.done;t3=h3.next())yv=t3.value,Cg=g.y(yv),eY=Cg.next().value,G1=Cg.next().value,Gg=eY,iM=G1,dS.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Gg,"mainVideoEntity",S1,tD,ySt(O,iM,d)));Cx=g.y(Qv.entries());for(VU=Cx.next();!VU.done;VU=Cx.next())Rp=VU.value,fd=g.y(Rp),e2=fd.next().value,Pd=fd.next().value,GA=e2,p9=Pd,dS.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
GA,"mainVideoEntity",S1,tD,ySt(O,p9,d)));dn=g.y(Ft);for(mm=dn.next();!mm.done;mm=dn.next())r3=mm.value,FH={playlistId:d},iu={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:FH},dS.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",r3,"mainVideoEntity",0,tD,iu));return As.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,dS))}})},TrJ=function(v,O){var Y,S,d,r;
return g.B(function(b){switch(b.U){case 1:return Y=z0(O),g.cm(b,2),S=g.We(O.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.E(b,Uf0(v.Y,O,v.G,(d=O.actionMetadata)==null?void 0:(r=d.offlineLoggingData)==null?void 0:r.offlineDeleteReason),5):g.E(b,$fY(S,v.Y,O,v.G),6);case 6:if(!v.Yg.V("woffle_enable_main_downloads_library")){b.d8(5);break}return g.E(b,plN(v.Y,O.entityKey),5);case 5:g.ai(b,3);break;case 2:return g.Tc(b),b.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},CEN=function(v,O,Y,S){var d,r,b,z,M,V,A;
return g.B(function(f){switch(f.U){case 1:return g.E(f,ZBv([O]),2);case 2:return d=f.Y,g.E(f,llS(v,d[0],Y,S),3);case 3:return r=f.Y,b=r.mainPlaylistEntity,z=r.pYW,V=AUY(b,(M=z)==null?void 0:M.avatar),g.cm(f,4),g.E(f,y0(V),6);case 6:g.ai(f,5);break;case 4:A=g.Tc(f),A instanceof Error&&A.message==="Failed to fetch"&&d9(A.message);case 5:return f.return(d[0].videos)}})},llS=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L;
return g.B(function(I){switch(I.U){case 1:d=Date.now().toString();Y||(Y=d);r=O.videos;b=O.playlistId;z=[];M=[];if(r)for(V=g.y(r),A=V.next();!A.done;A=V.next()){f=A.value;k=f.offlineVideoData;if(!k||!k.videoId)throw d9("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");U=k.videoId;c={videoId:U,playlistId:b};a={id:g.zh(JSON.stringify(c),"mainPlaylistVideoEntity"),video:g.zh(U,"mainVideoEntity")};z.push(a);M.push(a.id)}T={key:g.zh(b,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:Y,lastSyncedTimestampMillis:d};l={key:g.zh(b,"mainPlaylistEntity"),playlistId:b,videos:M,title:O.title,thumbnailStyleData:Fpt(O),visibility:hdK(O),downloadState:T.key};O.channel&&(Q=O.channel.offlineChannelData,x=Rdw(g.zh(b,"ytMainChannelEntity"),Q),l.channelOwner=x.id);((L=l)==null?0:L.entityMetadata)?(l.entityMetadata.offlineLastModifiedTimestampSeconds=O.lastModifiedTimestamp,S&&(l.entityMetadata.nextAutoRefreshIntervalSeconds=String(S))):l&&(l.entityMetadata={nextAutoRefreshIntervalSeconds:S?
String(S):void 0,offlineLastModifiedTimestampSeconds:O.lastModifiedTimestamp});g.cm(I,2);return g.E(I,tH(v.Y,{mode:"readwrite",vT:!0},function(t){var P=PF(t,l,"mainPlaylistEntity"),YQ=PF(t,T,"mainPlaylistDownloadStateEntity");P=[P,YQ];YQ=g.y(z);for(var dF=YQ.next();!dF.done;dF=YQ.next())P.push(PF(t,dF.value,"mainPlaylistVideoEntity"));x&&P.push(PF(t,x,"ytMainChannelEntity"));return g.az.all(P)}),4);
case 4:g.ai(I,3);break;case 2:throw g.Tc(I),d9("PES failure for playlist"),Error("PES failure for playlist");case 3:return I.return({mainPlaylistEntity:l,pYW:x,TU4:z})}})},Rdw=function(v,O){return{id:v,
channelId:O.channelId,title:O.title,avatar:O.thumbnail}},Fpt=function(v){var O=[],Y=v.videos;
Y&&Y.length>0&&O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:Y[0].offlineVideoData.thumbnail}}});if((v=v.additionalMetadadatas)&&v.length>0)for(v=g.y(v),Y=v.next();!Y.done;Y=v.next()){var S=Y.value.offlineBundleItemPlaylistData,d=void 0;Y=(d=S)==null?void 0:d.style;d=void 0;S={collageThumbnail:{coverThumbnail:(d=S)==null?void 0:d.coverThumbnail}};switch(Y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:S});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:S});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:S});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":O.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:S})}}return O},hdK=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ySt=function(v,O,Y){O={offlineVideoData:O,
playlistId:Y};if(v=g.q(v.actionMetadata,xMU))O.maximumDownloadQuality=v.maximumDownloadQuality;return{mainVideoEntityActionMetadata:O}},edN=function(v,O,Y){this.Y=v;
this.Yg=O;this.G=Y},Lpv=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c;
return g.B(function(a){switch(a.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,r=g.q(O.actionMetadata,Dw),z=!((b=r)==null?0:b.playlistId),g.cm(a,2),g.E(a,EG8(v,d,void 0,(M=r)==null?void 0:M.offlineVideoData,z),4);case 4:g.ai(a,3);break;case 2:return V=g.Tc(a),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.$d&&V.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
a.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,A,f));case 3:k=1;k=Number(((U=O.actionMetadata)==null?void 0:U.priority)||0)+1;var x=(x=g.q(O.actionMetadata,Dw))?{playbackDataActionMetadata:{maximumDownloadQuality:x.maximumDownloadQuality}}:void 0;c=Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d,"playbackData",k,Qnt,x);return a.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,[c]))}})},Brt=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l;
return g.B(function(Q){switch(Q.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,g.E(Q,HF(v.Y,O.entityKey,"mainVideoEntity"),2);case 2:r=Q.Y;if(!r){b=void 0;Q.d8(3);break}return g.E(Q,HF(v.Y,r.downloadState,"mainVideoDownloadStateEntity"),4);case 4:b=Q.Y;case 3:z=b;if(!r||!z)return Q.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));g.cm(Q,5);return g.E(Q,EG8(v,d,z.addedTimestampMillis,(V=g.q(O.actionMetadata,Dw))==null?void 0:V.offlineVideoData),7);case 7:A=1;A=Number(((f=
O.actionMetadata)==null?void 0:f.priority)||0)+1;M=Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"playbackData",A,Qnt);g.ai(Q,6);break;case 5:k=g.Tc(Q);if(!(k instanceof Error&&k.message==="No data")){if(k instanceof Error&&k.message==="Empty response body")d9(k.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.$d&&k.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,U,c));Q.d8(6);break}return g.E(Q,p1(v.Y,d),9);case 9:a=Q.Y;x=g.q(O.actionMetadata,Dw);if(l=(T=x)==null?void 0:T.playlistId)a.playlistId=l;a.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.E(Q,ac(d,v.Y,O,v.G,a),6);case 6:return Q.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,M?[M]:void 0))}})},ZOK=function(v,O){var Y,S,d,r,b,z,M,V,A,f;
return g.B(function(k){switch(k.U){case 1:return Y=z0(O),g.cm(k,2),S=g.We(O.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.E(k,Uf0(v.Y,O,v.G,(A=O.actionMetadata)==null?void 0:(f=A.offlineLoggingData)==null?void 0:f.offlineDeleteReason),5):g.E(k,p1(v.Y,S),6);case 6:d=k.Y;r=g.q(O.actionMetadata,Dw);if(z=(b=r)==null?void 0:b.playlistId)d.playlistId=z;d.offlineDeleteReason=(M=O.actionMetadata)==null?void 0:(V=M.offlineLoggingData)==null?void 0:V.offlineDeleteReason;return g.E(k,ac(S,v.Y,O,v.G,d),7);
case 7:if(!v.Yg.V("woffle_enable_main_downloads_library")){k.d8(5);break}return g.E(k,plN(v.Y,O.entityKey),5);case 5:g.ai(k,3);break;case 2:return g.Tc(k),k.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y))}})},EG8=function(v,O,Y,S,d){var r,b,z,M,V,A;
return g.B(function(f){switch(f.U){case 1:if(r=S){f.d8(2);break}return g.E(f,BAU([O]),3);case 3:b=f.Y,r=b[0];case 2:return g.E(f,XI0(v,r,Y,d),4);case 4:z=f.Y;M=z.mainVideoEntity;V=z.channelEntity;g.cm(f,5);var k=kq(M.thumbnail),U=kq(V.avatar);return g.E(f,y0(k.concat(U)),7);case 7:g.ai(f,0);break;case 5:A=g.Tc(f),A instanceof Error&&A.message==="Failed to fetch"&&d9(A.message),g.UE(f)}})},XI0=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k,U,c,a,x;
return g.B(function(T){switch(T.U){case 1:Y||(Y=Date.now().toString());r=(d=O.channel)==null?void 0:d.offlineChannelData;b={id:g.zh(O.videoId,"ytMainChannelEntity"),channelId:r.channelId,title:r.title,avatar:r.thumbnail};z={key:g.zh(O.videoId,"mainVideoDownloadStateEntity"),playbackData:g.zh(O.videoId,"playbackData"),addedTimestampMillis:Y,videoDownloadContextEntity:g.zh(O.videoId,"videoDownloadContextEntity")};M={key:g.zh(O.videoId,"videoPlaybackPositionEntity"),videoId:O.videoId,lastPlaybackPositionSeconds:"0"};
v.Yg.V("html5_offline_playback_position_sync")&&(V={playbackPosition:M.key});A=g.zh(O.videoId,"mainVideoEntity");f={key:A,videoId:O.videoId,title:O.title,thumbnail:O.thumbnail,localizedStrings:{viewCount:O.shortViewCountText},userState:V,lengthSeconds:O.lengthSeconds?Number(O.lengthSeconds):void 0,publishedTimestampMillis:O.publishedTimestamp?(Number(O.publishedTimestamp)*1E3).toString():void 0,formattedDescription:O.description,owner:b.id,downloadState:z.key};if(!v.Yg.V("woffle_enable_main_downloads_library")||
!S){T.d8(2);break}return g.E(T,aqY(v.Y,[A]),3);case 3:if(c=T.Y)k=c.mainDownloadsLibraryEntity,U=c.mainDownloadsListEntity;case 2:return x=WRL,a={key:g.zh(O.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.bi(z,x,a),g.E(T,tH(v.Y,{mode:"readwrite",vT:!0},function(l){var Q=PF(l,b,"ytMainChannelEntity"),L=PF(l,z,"mainVideoDownloadStateEntity"),I=PF(l,f,"mainVideoEntity");Q=[Q,L,I];v.Yg.V("html5_offline_playback_position_sync")&&(L=PF(l,M,"videoPlaybackPositionEntity"),
Q.push(L));k&&(L=PF(l,k,"mainDownloadsLibraryEntity"),Q.push(L));U&&(L=PF(l,U,"mainDownloadsListEntity"),Q.push(L));a&&(l=PF(l,a,"downloadStatusEntity"),Q.push(l));return g.az.all(Q)}),4);
case 4:return T.return({mainVideoEntity:f,channelEntity:b})}})},wIK=function(v,O,Y){this.Y=v;
this.Yg=O;this.G=Y},qsU=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D;
return g.B(function(yd){switch(yd.U){case 1:return Y=z0(O),S=[],g.E(yd,wm.getInstance(),2);case 2:d=yd.Y;if(!d){yd.d8(3);break}return g.E(yd,d.get("sdois"),4);case 4:return r=yd.Y,g.E(yd,(z=d)==null?void 0:z.get("lmqf"),5);case 5:b=yd.Y;case 3:g.cm(yd,6);if(r===void 0)throw Error("prefStorage or opt-in state is undefined");M=[];if(r){yd.d8(8);break}return g.E(yd,yUw(v.Y),9);case 9:M=yd.Y,M.reverse();case 8:if(!M.length){yd.d8(10);break}V=g.y(M);A=V.next();case 11:if(A.done){yd.d8(10);break}f=A.value;
if(!f){yd.d8(12);break}k=g.We(f).entityId;return g.E(yd,p1(v.Y,k),14);case 14:return U=yd.Y,U.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.E(yd,ac(k,v.Y,{entityKey:f,actionType:O.actionType},v.G,U),12);case 12:A=V.next();yd.d8(11);break;case 10:return g.E(yd,qCS(r,(c=b)!=null?c:"SD"),16);case 16:return a=yd.Y,g.E(yd,cUw(a),17);case 17:x=CeU(a);if(!v.Yg.V("woffle_enable_main_downloads_library")){yd.d8(18);break}if(r){yd.d8(19);break}return g.E(yd,plN(v.Y,g.Q1),19);case 19:return g.E(yd,
xfN(v.Y,[g.Q1]),18);case 18:if((T=x)==null?0:T.length)for(l=g.y(x),Q=l.next();!Q.done;Q=l.next())if(I=L=Q.value,t=I.actionType,P=I.entityKey,YQ=I.actionMetadata,t&&P&&YQ&&!g.q(YQ,Ilv)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(YQ.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(dF=g.q(L.actionMetadata,Dw))dF.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",L.actionMetadata=Object.assign({},L.actionMetadata,{mainVideoEntityActionMetadata:dF});S.push(L)}g.ai(yd,
7);break;case 6:return N=g.Tc(yd),j1="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.$d&&N.type==="QUOTA_EXCEEDED"&&(j1="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",D="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),yd.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,j1,D));case 7:return yd.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,S))}})},nGN=function(){iD.apply(this,
arguments);
this.j="mainVideoEntity"},JSS=function(v,O,Y){O=O===void 0?43200:O;
Y=Y===void 0?!0:Y;var S=S===void 0?!1:S;var d,r,b;return g.B(function(z){switch(z.U){case 1:if(!v.C.hE())return z.return([]);d=[];g.cm(z,2);return g.E(z,wlN(O,Y,S),4);case 4:d=z.Y;g.ai(z,3);break;case 2:r=g.Tc(z),r instanceof Error&&r.message==="No data"||r instanceof Error&&r.message==="Empty response body"&&d9(r.message);case 3:return b=UMJ(v,d,Y,"mainPlaylistEntity"),z.return(b)}})},KpY=function(v,O,Y,S){S=S===void 0?!1:S;
var d,r,b,z,M,V,A,f,k,U,c,a,x,T,l;return g.B(function(Q){switch(Q.U){case 1:return d=[],g.E(Q,Iqv(),2);case 2:return(r=Q.Y)||S?g.E(Q,nHL(O,Y),3):Q.return([]);case 3:b=Q.Y;if((z=b)==null||!z.length)return Q.return([]);M={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};V=g.y(b);A=V.next();case 4:if(A.done){Q.d8(6);break}k=f=A.value;U=k.actionType;c=k.entityKey;a=k.actionMetadata;if(!(U&&c&&a)||g.q(a,Ilv)){Q.d8(5);break}U==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.offlineLoggingData=
M);x=g.We(c);T=x.entityId;return g.E(Q,md(v,[T],"mainVideoEntity",U,a),8);case 8:l=Q.Y,d=d.concat(l);case 5:A=V.next();Q.d8(4);break;case 6:return Q.return(d)}})},PEC=function(v,O){this.Y=v;
this.G=O},iOK=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T;
return g.B(function(l){switch(l.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,r=[],g.cm(l,2),g.E(l,GfU(v,d),4);case 4:r=l.Y;if((b=r)==null||!b.length){l.d8(5);break}return g.E(l,ROK(v.Y,O.entityKey),5);case 5:g.ai(l,3);break;case 2:return z=g.Tc(l),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.$d&&z.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,M,V));case 3:return A=[],g.E(l,zOJ(v.Y,"musicTrack",r),7);case 7:r=l.Y;if(r.length)for(f=g.y(r),k=f.next();!k.done;k=f.next())if(U=k.value,c=U.offlineVideoData,a=void 0,(a=c)==null?0:a.videoId)x=void 0,T=Number(((x=O.actionMetadata)==null?void 0:x.priority)||0)+1,A.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"musicTrack",T,H9,hD(O,c,d)));return l.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,A))}})},
mMY=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p,oi,P0,uh,lL,AY,Xw,Qv,Ft,h,R,e,Z,n,Cn,OE,kQ,S1,h3,t3,yv,Cg,eY,G1;
return g.B(function(Gg){switch(Gg.U){case 1:return Y=z0(O),S=O.entityKey,d=g.We(S).entityId,r=[],b=!1,d==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.E(Gg,NT(v.Y,"musicAlbumRelease"),5)):g.E(Gg,HF(v.Y,S,"musicAlbumRelease"),4);case 4:(z=Gg.Y)&&r.push(z);Gg.d8(3);break;case 5:r=Gg.Y;case 3:if((M=r)==null||!M.length)return Gg.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));if(b){V=[];A=g.y(r);for(f=A.next();!f.done;f=A.next())k=f.value,U=g.We(k.id).entityId,V.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
U,"musicAlbumRelease",0,H9));return Gg.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,V))}c=[];a=r[0];x=void 0;if(!a.downloadMetadata){Gg.d8(6);break}return g.E(Gg,HF(v.Y,a.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:T=Gg.Y,x=Number((Q=(l=T)==null?void 0:l.addedTimestampMillis)!=null?Q:"0")/1E3;case 6:return g.cm(Gg,8),g.E(Gg,GfU(v,d,(L=x)==null?void 0:L.toString()),10);case 10:c=Gg.Y;g.ai(Gg,9);break;case 8:I=g.Tc(Gg);if(!(I instanceof Error&&I.message===
"No data")){if(I instanceof Error&&I.message==="Empty response body")d9(I.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",I instanceof g.$d&&I.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",P="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Gg.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,t,P));Gg.d8(9);break}return g.E(Gg,lD(d,"musicAlbumRelease",v.Y,
O,v.G),9);case 9:YQ=[];dF=new Map;if((N=c)==null?0:N.length)for(j1=g.y(c),D=j1.next();!D.done;D=j1.next())yd=D.value,pn=yd.offlineVideoData,Qd=void 0,((Qd=pn)==null?0:Qd.videoId)&&dF.set(pn.videoId,pn);uL=new Map;jU=[];if((ll=a)==null?0:(xQ=ll.tracks)==null?0:xQ.length)for(dS=g.y(a.tracks),p=dS.next();!p.done;p=dS.next())if(oi=p.value,P0=g.We(oi).entityId)dF.has(P0)?(uL.set(P0,dF.get(P0)),dF.delete(P0)):jU.push(P0);lL=Number(((uh=O.actionMetadata)==null?void 0:uh.priority)||0)+1;AY=g.y(dF.entries());
for(Xw=AY.next();!Xw.done;Xw=AY.next())Qv=Xw.value,Ft=g.y(Qv),h=Ft.next().value,R=Ft.next().value,e=h,Z=R,YQ.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",e,"musicTrack",lL,H9,hD(O,Z)));n=g.y(uL.entries());for(Cn=n.next();!Cn.done;Cn=n.next())OE=Cn.value,kQ=g.y(OE),S1=kQ.next().value,h3=kQ.next().value,t3=S1,yv=h3,YQ.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t3,"musicTrack",lL,H9,hD(O,yv)));Cg=g.y(jU);for(eY=Cg.next();!eY.done;eY=Cg.next())G1=eY.value,YQ.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
G1,"musicTrack",0,H9));return Gg.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,YQ))}})},tiN=function(v,O){var Y,S;
return g.B(function(d){switch(d.U){case 1:return Y=z0(O),g.cm(d,2),S=g.We(O.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.E(d,F1(v.Y,O,v.G),5):g.E(d,lD(S,"musicAlbumRelease",v.Y,O,v.G),6);case 6:return g.E(d,eOS(v.Y,O.entityKey),5);case 5:g.ai(d,3);break;case 2:return g.Tc(d),d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},GfU=function(v,O,Y){var S,d,r;
return g.B(function(b){switch(b.U){case 1:return g.E(b,ZBv([O]),2);case 2:return S=b.Y,g.E(b,DMS(v,S[0],Y),3);case 3:return d=b.Y,r=kq(d.thumbnailDetails),g.E(b,y0(r),4);case 4:return b.return(S[0].videos)}})},DMS=function(v,O,Y){var S,d,r,b,z,M,V,A,f,k,U,c,a,x;
return g.B(function(T){if(T.U==1){S=O.additionalMetadadatas;d=void 0;if(S&&S.length>0)for(r=g.y(S),b=r.next();!b.done;b=r.next())if(z=b.value,z.offlineMusicPlaylistData){d=z.offlineMusicPlaylistData;break}M=O.playlistId;V=EHt(O);A=V.MA;f=V.G4;k=Y?(Number(Y)*1E3).toString():Date.now().toString();U=O.lastModifiedTimestamp?(Number(O.lastModifiedTimestamp)*1E3).toString():"0";c={id:g.zh(M,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:f,lastModifiedTimestampMillis:U,addedTimestampMillis:k,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};a={id:g.zh(M,"musicAlbumRelease"),title:O.title,audioPlaylistId:M,trackCount:O.totalVideoCount,tracks:A,downloadMetadata:c.id};d&&(a.thumbnailDetails=(x=d.albumHqThumbnail)!=null?x:d.albumArtistThumbnail,a.artistDisplayName=d.albumArtistDisplayName,a.releaseDate=d.albumReleaseDate,a.contentRating={explicitType:d.albumReleaseExplicitType},a.releaseType=d.albumReleaseType);return g.E(T,tH(v.Y,{mode:"readwrite",vT:!0},function(l){var Q=PF(l,a,"musicAlbumRelease");
l=PF(l,c,"musicAlbumReleaseDownloadMetadataEntity");return g.az.all([Q,l])}),2)}return T.return(a)})},HOS=function(v,O){this.Y=v;
this.G=O},v0K=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T;
return g.B(function(l){switch(l.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,r=[],g.cm(l,2),g.E(l,Nrt(v,d),4);case 4:r=l.Y;if((b=r)==null||!b.length){l.d8(5);break}return g.E(l,ROK(v.Y,O.entityKey),5);case 5:g.ai(l,3);break;case 2:return z=g.Tc(l),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z instanceof g.$d&&z.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
l.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,M,V));case 3:return A=[],g.E(l,zOJ(v.Y,"musicTrack",r),7);case 7:r=l.Y;if(r.length)for(f=g.y(r),k=f.next();!k.done;k=f.next())if(U=k.value,c=U.offlineVideoData,a=void 0,(a=c)==null?0:a.videoId)x=void 0,T=Number(((x=O.actionMetadata)==null?void 0:x.priority)||0)+1,A.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"musicTrack",T,Np,hD(O,c,d)));return l.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,A))}})},
OYv=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p,oi,P0,uh,lL,AY,Xw,Qv,Ft,h,R,e,Z,n,Cn,OE,kQ,S1,h3,t3,yv,Cg,eY,G1,Gg,iM,Cx,VU,Rp,fd,e2,Pd,GA,p9,dn,mm;
return g.B(function(r3){switch(r3.U){case 1:return Y=z0(O),S=O.entityKey,d=g.We(S).entityId,r=[],b=!1,d==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.E(r3,NT(v.Y,"musicPlaylist"),5)):g.E(r3,HF(v.Y,S,"musicPlaylist"),4);case 4:(z=r3.Y)&&r.push(z);r3.d8(3);break;case 5:r=r3.Y;case 3:if((M=r)==null||!M.length)return r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));V=g.q(O.actionMetadata,QSL);f=(A=V)==null?void 0:A.autoSync;k=[];c=U=!0;a=!1;x=void 0;if(!b&&f===!1){r3.d8(6);break}g.cm(r3,7);return g.E(r3,
JUN(0,!!f,!0,r),9);case 9:k=r3.Y;g.ai(r3,8);break;case 7:T=g.Tc(r3);if(!(T instanceof Error&&T.message==="No data")){T instanceof Error&&T.message==="Empty response body"&&d9(T.message);r3.d8(8);break}return d==="!*$_ALL_ENTITIES_!*$"?g.E(r3,F1(v.Y,O,v.G),8):g.E(r3,lD(d,"musicPlaylist",v.Y,O,v.G),8);case 8:if(!k.length||!b&&k[0].playlistId!==d)return r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));case 6:if(b){l=[];Q=g.y(k);for(L=Q.next();!L.done;L=Q.next())I=L.value,I.upToDate||
f&&!I.shouldAutoSyncMetadata||!I.playlistId||(t={autoSync:f},l.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",I.playlistId,"musicPlaylist",0,Np,{musicPlaylistEntityActionMetadata:t})));return r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,l))}k.length&&(P=k[0],a=!!P.upToDate,f&&(U=(YQ=P.shouldAutoSyncMetadata)!=null?YQ:!0,c=(dF=P.shouldAutoSyncVideos)!=null?dF:!0,P.checkInSeconds&&(x=P.checkInSeconds)));if(a||!U)return r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));N=[];j1=r[0];D=void 0;if(!j1.downloadMetadata){r3.d8(15);break}return g.E(r3,HF(v.Y,j1.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:yd=r3.Y,D=Number((Qd=(pn=yd)==null?void 0:pn.addedTimestampMillis)!=null?Qd:"0")/1E3;case 15:return g.cm(r3,17),g.E(r3,Nrt(v,d,(uL=D)==null?void 0:uL.toString(),x),19);case 19:N=r3.Y;g.ai(r3,18);break;case 17:jU=g.Tc(r3);if(!(jU instanceof Error&&jU.message==="No data")){if(jU instanceof Error&&jU.message==="Empty response body")d9(jU.message);
else return ll="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",xQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",jU instanceof g.$d&&jU.type==="QUOTA_EXCEEDED"&&(ll="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",xQ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,ll,xQ));r3.d8(18);break}return g.E(r3,lD(d,"musicPlaylist",v.Y,O,v.G),18);case 18:if(!c)return r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y));dS=[];p=new Map;if((oi=N)==null?0:oi.length)for(P0=g.y(N),uh=P0.next();!uh.done;uh=P0.next())lL=uh.value,AY=lL.offlineVideoData,Xw=void 0,((Xw=AY)==null?0:Xw.videoId)&&p.set(AY.videoId,AY);Qv=new Map;Ft=[];if((h=j1)==null?0:(R=h.tracks)==null?0:R.length)for(e=g.y(j1.tracks),Z=e.next();!Z.done;Z=e.next())if(n=Z.value,Cn=g.We(n).entityId)p.has(Cn)?(Qv.set(Cn,p.get(Cn)),p.delete(Cn)):Ft.push(Cn);kQ=Number(((OE=O.actionMetadata)==null?void 0:OE.priority)||0)+1;S1=g.y(p.entries());for(h3=S1.next();!h3.done;h3=
S1.next())t3=h3.value,yv=g.y(t3),Cg=yv.next().value,eY=yv.next().value,G1=Cg,Gg=eY,dS.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G1,"musicTrack",kQ,Np,hD(O,Gg)));iM=g.y(Qv.entries());for(Cx=iM.next();!Cx.done;Cx=iM.next())VU=Cx.value,Rp=g.y(VU),fd=Rp.next().value,e2=Rp.next().value,Pd=fd,GA=e2,dS.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Pd,"musicTrack",kQ,Np,hD(O,GA)));p9=g.y(Ft);for(dn=p9.next();!dn.done;dn=p9.next())mm=dn.value,dS.push(Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
mm,"musicTrack",0,Np));return r3.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,dS))}})},YyN=function(v,O){var Y,S;
return g.B(function(d){switch(d.U){case 1:return Y=z0(O),g.cm(d,2),S=g.We(O.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.E(d,F1(v.Y,O,v.G),5):g.E(d,lD(S,"musicPlaylist",v.Y,O,v.G),6);case 6:return g.E(d,eOS(v.Y,O.entityKey),5);case 5:g.ai(d,3);break;case 2:return g.Tc(d),d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},Nrt=function(v,O,Y,S){var d,r,b;
return g.B(function(z){switch(z.U){case 1:return g.E(z,ZBv([O]),2);case 2:return d=z.Y,g.E(z,SyS(v,d[0],Y,S),3);case 3:return r=z.Y,b=kq(r.thumbnailDetails),g.E(z,y0(b),4);case 4:return z.return(d[0].videos)}})},SyS=function(v,O,Y,S){var d,r,b,z,M,V,A,f,k;
return g.B(function(U){return U.U==1?(d=O.playlistId,r=EHt(O),b=r.MA,z=r.G4,M=Y?(Number(Y)*1E3).toString():Date.now().toString(),V=O.lastModifiedTimestamp?(Number(O.lastModifiedTimestamp)*1E3).toString():"0",A={id:g.zh(d,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:z,lastModifiedTimestampMillis:V,addedTimestampMillis:M,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},f={id:g.zh(d,"musicPlaylist"),title:O.title,playlistId:d,thumbnailDetails:O.thumbnail,visibility:d7L(O),trackCount:O.totalVideoCount,
tracks:b,downloadMetadata:A.id},S&&(((k=f)==null?0:k.entityMetadata)?f.entityMetadata.nextAutoRefreshIntervalSeconds=String(S):f&&(f.entityMetadata={nextAutoRefreshIntervalSeconds:String(S)})),g.E(U,tH(v.Y,{mode:"readwrite",vT:!0},function(c){var a=PF(c,f,"musicPlaylist");c=PF(c,A,"musicPlaylistDownloadMetadataEntity");return g.az.all([a,c])}),2)):U.return(f)})},d7L=function(v){switch(v.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},r5L=function(v,O){this.Y=v;
this.G=O},WqL=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c;
return g.B(function(a){switch(a.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,r=g.q(O.actionMetadata,bYS),g.cm(a,2),g.E(a,o0Y(v,d,void 0,(b=r)==null?void 0:b.track,(z=r)==null?void 0:z.albumRelease),4);case 4:if((M=r)==null?0:M.playlistId){a.d8(5);break}return g.E(a,ROK(v.Y,O.entityKey),5);case 5:g.ai(a,3);break;case 2:return V=g.Tc(a),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.$d&&V.type==="QUOTA_EXCEEDED"&&
(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),a.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,A,f));case 3:U=Number(((k=O.actionMetadata)==null?void 0:k.priority)||0)+1;var x=(x=g.q(O.actionMetadata,bYS))?{playbackDataActionMetadata:{maximumDownloadQuality:x.maximumDownloadQuality}}:void 0;c=Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",d,"playbackData",U,j$L,x);return a.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y,[c]))}})},z2N=function(v,O){var Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x;
return g.B(function(T){switch(T.U){case 1:return Y=z0(O),S=g.We(O.entityKey),d=S.entityId,g.E(T,HF(v.Y,O.entityKey,"musicTrack"),2);case 2:r=T.Y;if(!r){b=void 0;T.d8(3);break}return g.E(T,HF(v.Y,r.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:b=T.Y;case 3:z=b;if(!r||!z)return T.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y));V=g.q(O.actionMetadata,bYS);g.cm(T,5);return g.E(T,o0Y(v,d,z.addedTimestampMillis,(A=V)==null?void 0:A.track,(f=V)==null?void 0:f.albumRelease),
7);case 7:U=Number(((k=O.actionMetadata)==null?void 0:k.priority)||0)+1;M=Q0("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"playbackData",U,j$L);g.ai(T,6);break;case 5:c=g.Tc(T);if(!(c instanceof Error&&c.message==="No data")){if(c instanceof Error&&c.message==="Empty response body")d9(c.message);else return a="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.$d&&c.type==="QUOTA_EXCEEDED"&&(a="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),T.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,a,x));T.d8(6);break}return g.E(T,T0(d,v.Y,O,v.G),6);case 6:return T.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",Y,M?[M]:void 0))}})},s$Y=function(v,O){var Y,S;
return g.B(function(d){switch(d.U){case 1:return Y=z0(O),g.cm(d,2),S=g.We(O.entityKey).entityId,S==="!*$_ALL_ENTITIES_!*$"?g.E(d,F1(v.Y,O,v.G),5):g.E(d,T0(S,v.Y,O,v.G),6);case 6:return g.E(d,eOS(v.Y,O.entityKey),5);case 5:g.ai(d,3);break;case 2:return g.Tc(d),d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new L1("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
Y))}})},o0Y=function(v,O,Y,S,d){var r,b,z,M,V,A;
return g.B(function(f){switch(f.U){case 1:if(r=S){f.d8(2);break}return g.E(f,BAU([O]),3);case 3:b=f.Y,z=b[0],r=hOC(z);case 2:return g.E(f,g0t(v,r,O,d,Y),4);case 4:M=f.Y;V=M.musicTrackEntity;A=M.LV;var k=kq(V.thumbnailDetails),U=[];A&&(U=kq(A.thumbnailDetails));return g.E(f,y0(k.concat(U)),0)}})},g0t=function(v,O,Y,S,d){var r;
return g.B(function(b){return b.U==1?(d||(d=Date.now().toString()),r={id:g.zh(Y,"musicTrackDownloadMetadataEntity"),playbackData:g.zh(Y,"playbackData"),addedTimestampMillis:d,videoDownloadContextEntity:g.zh(Y,"videoDownloadContextEntity")},S&&(O.albumRelease=S.id),g.E(b,tH(v.Y,{mode:"readwrite",vT:!0},function(z){var M=[],V=PF(z,r,"musicTrackDownloadMetadataEntity");M.push(V);V=PF(z,O,"musicTrack");M.push(V);S&&(z=PF(z,S,"musicAlbumRelease"),M.push(z));return g.az.all(M)}),2)):b.U!=3?g.E(b,AD(Y,"musicTrackDownloadMetadataEntity",
v.Y,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):b.return({musicTrackEntity:O,
LV:S})})},v_=function(){iD.apply(this,arguments);
this.j="musicTrack"},MrN=function(v,O,Y){O=O===void 0?43200:O;
Y=Y===void 0?!0:Y;var S=S===void 0?!1:S;var d,r;return g.B(function(b){switch(b.U){case 1:if(!v.C.hE())return b.return([]);d=[];g.cm(b,2);return g.E(b,JUN(O,Y,S),4);case 4:d=b.Y;g.ai(b,3);break;case 2:g.Tc(b);case 3:return r=UMJ(v,d,Y,"musicPlaylist"),b.return(r)}})},VrN=function(){g.gx.apply(this,arguments);
var v=this;this.events=new g.Z6(this);this.Yg=this.player.D();this.Qg={gi1:function(){return v.Y},
Oo:function(){return v.Oo()},
YJ:function(O){return v.YJ(O)}}},A5L=function(v){var O;
v=g.q((O=v.getWatchNextResponse())==null?void 0:O.currentVideoEndpoint,g.Gj);if(v==null?0:v.playlistId)var Y=v.playlistId;return Y},fr8=function(v,O){var Y,S,d,r;
return g.B(function(b){if(b.U==1){Y=O.clientPlaybackNonce;S={cpn:Y,offlineSourceVisualElement:g.am(O.g8||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};O.U&&(S.videoFmt=Number(O.U.itag));O.B&&(S.audioFmt=Number(O.B.itag));if((d=A5L(O))&&O.videoId){var z=O.videoId;z=d!=="PPSV"?Promise.resolve(!1):v.Y.zQ(z);b=g.E(b,z,3)}else b=b.d8(2);return b}b.U!=2&&(r=b.Y)&&(S.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");v.U=Y;g.z2("offlinePlaybackStarted",S);g.UE(b)})};
g.UT.prototype.Bf=g.rF(51,function(v){return this.app.Bf(v)});
g.MI.prototype.Bf=g.rF(50,function(v){return g.X91(this,9,v)});
g.C(Z7,BF);g.bl.Object.defineProperties(Z7.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Y.entityMetadata},
set:function(v){this.Y.entityMetadata=v}}});
g.C(jNv,Z7);jNv.prototype.U=function(){return[]};
g.C(WGY,Z7);WGY.prototype.U=function(){return[]};
g.C(zRY,Z7);zRY.prototype.U=function(){return[]};
g.C(sN0,Z7);sN0.prototype.U=function(){return[]};
g.C(g3U,Z7);g3U.prototype.U=function(){var v=[];this.Y.alternateChannel&&v.push(this.Y.alternateChannel);this.Y.alternateChannelList&&v.push.apply(v,g.F(this.Y.alternateChannelList));this.Y.oneofChannelEntity&&v.push(this.Y.oneofChannelEntity);return[].concat(g.F(new Set(v)))};
g.C(MgN,Z7);MgN.prototype.U=function(){var v=[];this.Y.entryCollection&&v.push(this.Y.entryCollection);return[].concat(g.F(new Set(v)))};
g.C(VgN,BF);VgN.prototype.U=function(){var v=[];this.Y.video&&v.push(this.Y.video);return[].concat(g.F(new Set(v)))};
g.C(AF0,Z7);AF0.prototype.U=function(){var v=[];this.Y.parentPlaylist&&v.push(this.Y.parentPlaylist);if(this.Y.entries)for(var O=g.y(this.Y.entries),Y=O.next();!Y.done;Y=O.next())v.push.apply(v,g.F((new VgN(Y.value)).U()));return[].concat(g.F(new Set(v)))};
g.C(f$S,Z7);f$S.prototype.U=function(){var v=[];this.Y.descriptionEntity&&v.push(this.Y.descriptionEntity);this.Y.creators&&v.push.apply(v,g.F(this.Y.creators));this.Y.theBiggestFan&&v.push(this.Y.theBiggestFan);return[].concat(g.F(new Set(v)))};
g.C($2Y,Z7);$2Y.prototype.U=function(){return[]};
g.C(kAS,Z7);kAS.prototype.U=function(){return[]};
g.C(U2N,Z7);U2N.prototype.U=function(){return[]};
g.C(cF0,Z7);cF0.prototype.U=function(){return[]};
g.C(ugN,Z7);ugN.prototype.U=function(){return[]};
g.C(CNL,Z7);CNL.prototype.U=function(){return[]};
g.C(yF0,Z7);yF0.prototype.U=function(){return[]};
g.C(a$N,Z7);a$N.prototype.U=function(){return[]};
g.C(x2J,Z7);x2J.prototype.U=function(){return[]};
g.C(pdJ,Z7);pdJ.prototype.U=function(){var v=[];this.Y.downloadsList&&v.push(this.Y.downloadsList);this.Y.smartDownloadsList&&v.push(this.Y.smartDownloadsList);this.Y.recommendedDownloadsList&&v.push(this.Y.recommendedDownloadsList);this.Y.refresh&&v.push(this.Y.refresh);return[].concat(g.F(new Set(v)))};
g.C(TcY,BF);TcY.prototype.U=function(){var v=[];this.Y.video&&v.push(this.Y.video);this.Y.playlist&&v.push(this.Y.playlist);this.Y.videoItem&&v.push(this.Y.videoItem);this.Y.playlistItem&&v.push(this.Y.playlistItem);return[].concat(g.F(new Set(v)))};
g.C(l$U,Z7);l$U.prototype.U=function(){var v=[];this.Y.refresh&&v.push(this.Y.refresh);if(this.Y.downloads)for(var O=g.y(this.Y.downloads),Y=O.next();!Y.done;Y=O.next())v.push.apply(v,g.F((new TcY(Y.value)).U()));return[].concat(g.F(new Set(v)))};
g.C(FGL,Z7);FGL.prototype.U=function(){var v=[];this.Y.localImageEntities&&v.push.apply(v,g.F(this.Y.localImageEntities));return[].concat(g.F(new Set(v)))};
g.C(hRv,Z7);hRv.prototype.U=function(){var v=[];this.Y.playbackData&&v.push(this.Y.playbackData);this.Y.localImageEntities&&v.push.apply(v,g.F(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&v.push(this.Y.videoDownloadContextEntity);return[].concat(g.F(new Set(v)))};
g.C(RRS,Z7);RRS.prototype.U=function(){return[]};
g.C(eR0,Z7);eR0.prototype.U=function(){var v=[];this.Y.fakeChildren&&v.push.apply(v,g.F(this.Y.fakeChildren));return[].concat(g.F(new Set(v)))};
g.C(E3C,Z7);E3C.prototype.U=function(){var v=[];this.Y.video&&v.push(this.Y.video);this.Y.playbackData&&v.push(this.Y.playbackData);this.Y.offlineVideoPolicy&&v.push(this.Y.offlineVideoPolicy);return[].concat(g.F(new Set(v)))};
g.C(QN8,Z7);QN8.prototype.U=function(){return[]};
g.C(LGK,Z7);LGK.prototype.U=function(){var v=[];this.Y.channelOwner&&v.push(this.Y.channelOwner);this.Y.videos&&v.push.apply(v,g.F(this.Y.videos));this.Y.collaboratorChannels&&v.push.apply(v,g.F(this.Y.collaboratorChannels));this.Y.downloadState&&v.push(this.Y.downloadState);this.Y.refresh&&v.push(this.Y.refresh);return[].concat(g.F(new Set(v)))};
g.C(BcK,Z7);BcK.prototype.U=function(){var v=[];this.Y.video&&v.push(this.Y.video);this.Y.channelContributor&&v.push(this.Y.channelContributor);return[].concat(g.F(new Set(v)))};
g.C(Z58,BF);Z58.prototype.U=function(){var v=[];this.Y.localImageEntities&&v.push.apply(v,g.F(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&v.push(this.Y.videoDownloadContextEntity);return[].concat(g.F(new Set(v)))};
g.C(XdY,BF);XdY.prototype.U=function(){var v=[];this.Y.recommendedVideoMetadata&&v.push.apply(v,g.F((new Z58(this.Y.recommendedVideoMetadata)).U()));return[].concat(g.F(new Set(v)))};
g.C(wdK,BF);wdK.prototype.U=function(){var v=[];this.Y.playbackPosition&&v.push(this.Y.playbackPosition);return[].concat(g.F(new Set(v)))};
g.C(I$J,Z7);I$J.prototype.U=function(){var v=[];this.Y.owner&&v.push(this.Y.owner);this.Y.downloadState&&v.push(this.Y.downloadState);this.Y.userState&&v.push.apply(v,g.F((new wdK(this.Y.userState)).U()));this.Y.additionalMetadata&&v.push.apply(v,g.F((new XdY(this.Y.additionalMetadata)).U()));return[].concat(g.F(new Set(v)))};
g.C(qfN,Z7);qfN.prototype.U=function(){var v=[];this.Y.userChannelDetails&&v.push(this.Y.userChannelDetails);return[].concat(g.F(new Set(v)))};
g.C(n3Y,Z7);n3Y.prototype.U=function(){var v=[];this.Y.channelOwner&&v.push(this.Y.channelOwner);this.Y.playbackPosition&&v.push(this.Y.playbackPosition);this.Y.localImageEntities&&v.push.apply(v,g.F(this.Y.localImageEntities));this.Y.downloadStatus&&v.push(this.Y.downloadStatus);return[].concat(g.F(new Set(v)))};
g.C(JF0,Z7);JF0.prototype.U=function(){return[]};
g.C(KGC,Z7);KGC.prototype.U=function(){return[]};
g.C(PNU,Z7);PNU.prototype.U=function(){return[]};
g.C(GAN,Z7);GAN.prototype.U=function(){return[]};
g.C(i5t,Z7);i5t.prototype.U=function(){return[]};
g.C(m2N,Z7);m2N.prototype.U=function(){return[]};
g.C(tgt,Z7);tgt.prototype.U=function(){return[]};
g.C(D20,Z7);D20.prototype.U=function(){return[]};
g.C(H5L,Z7);H5L.prototype.U=function(){return[]};
g.C(NcN,Z7);NcN.prototype.U=function(){return[]};
g.C(vXv,Z7);vXv.prototype.U=function(){return[]};
g.C(OKC,Z7);OKC.prototype.U=function(){var v=[];this.Y.trackDownloadMetadatas&&v.push.apply(v,g.F(this.Y.trackDownloadMetadatas));return[].concat(g.F(new Set(v)))};
g.C(Y6Y,Z7);
Y6Y.prototype.U=function(){var v=[];this.Y.downloadedTracks&&v.push.apply(v,g.F(this.Y.downloadedTracks));this.Y.smartDownloadedTracks&&v.push.apply(v,g.F(this.Y.smartDownloadedTracks));this.Y.downloadedEpisodes&&v.push.apply(v,g.F(this.Y.downloadedEpisodes));this.Y.downloadedAlbumReleases&&v.push.apply(v,g.F(this.Y.downloadedAlbumReleases));this.Y.smartDownloadedAlbumReleases&&v.push.apply(v,g.F(this.Y.smartDownloadedAlbumReleases));this.Y.downloadedPlaylists&&v.push.apply(v,g.F(this.Y.downloadedPlaylists));this.Y.smartDownloadedPlaylists&&
v.push.apply(v,g.F(this.Y.smartDownloadedPlaylists));this.Y.metadataOnlyTracks&&v.push.apply(v,g.F(this.Y.metadataOnlyTracks));return[].concat(g.F(new Set(v)))};
g.C(S6U,Z7);S6U.prototype.U=function(){var v=[];this.Y.trackDownloadMetadatas&&v.push.apply(v,g.F(this.Y.trackDownloadMetadatas));return[].concat(g.F(new Set(v)))};
g.C(dZK,Z7);dZK.prototype.U=function(){var v=[];this.Y.playbackData&&v.push(this.Y.playbackData);this.Y.localImageEntities&&v.push.apply(v,g.F(this.Y.localImageEntities));this.Y.videoDownloadContextEntity&&v.push(this.Y.videoDownloadContextEntity);return[].concat(g.F(new Set(v)))};
g.C(ruN,Z7);ruN.prototype.U=function(){var v=[];this.Y.musicLibraryStatusEntity&&v.push(this.Y.musicLibraryStatusEntity);this.Y.primaryArtists&&v.push.apply(v,g.F(this.Y.primaryArtists));this.Y.details&&v.push(this.Y.details);this.Y.userDetails&&v.push(this.Y.userDetails);this.Y.tracks&&v.push.apply(v,g.F(this.Y.tracks));this.Y.share&&v.push(this.Y.share);this.Y.downloadMetadata&&v.push(this.Y.downloadMetadata);this.Y.refresh&&v.push(this.Y.refresh);return[].concat(g.F(new Set(v)))};
g.C(bK0,Z7);bK0.prototype.U=function(){var v=[];this.Y.albumRelease&&v.push(this.Y.albumRelease);this.Y.tracks&&v.push.apply(v,g.F(this.Y.tracks));return[].concat(g.F(new Set(v)))};
g.C(oXt,Z7);oXt.prototype.U=function(){var v=[];this.Y.albumRelease&&v.push(this.Y.albumRelease);return[].concat(g.F(new Set(v)))};
g.C(js0,Z7);js0.prototype.U=function(){var v=[];this.Y.details&&v.push(this.Y.details);this.Y.userDetails&&v.push(this.Y.userDetails);return[].concat(g.F(new Set(v)))};
g.C(WfN,Z7);WfN.prototype.U=function(){var v=[];this.Y.parentArtist&&v.push(this.Y.parentArtist);return[].concat(g.F(new Set(v)))};
g.C(zvY,Z7);zvY.prototype.U=function(){var v=[];this.Y.parentArtist&&v.push(this.Y.parentArtist);return[].concat(g.F(new Set(v)))};
g.C(ss8,Z7);ss8.prototype.U=function(){return[]};
g.C(gXU,Z7);gXU.prototype.U=function(){return[]};
g.C(M6U,BF);M6U.prototype.U=function(){var v=[];this.Y.creatorEntity&&v.push(this.Y.creatorEntity);return[].concat(g.F(new Set(v)))};
g.C(V6S,Z7);
V6S.prototype.U=function(){var v=[];this.Y.tracks&&v.push.apply(v,g.F(this.Y.tracks));this.Y.refresh&&v.push(this.Y.refresh);this.Y.musicLibraryStatusEntity&&v.push(this.Y.musicLibraryStatusEntity);this.Y.details&&v.push(this.Y.details);this.Y.downloadMetadata&&v.push(this.Y.downloadMetadata);this.Y.sideloadMetadata&&v.push(this.Y.sideloadMetadata);this.Y.userDetails&&v.push(this.Y.userDetails);this.Y.entryCollection&&v.push(this.Y.entryCollection);this.Y.share&&v.push(this.Y.share);this.Y.podcastShowAdditionalMetadata&&v.push.apply(v,
g.F((new M6U(this.Y.podcastShowAdditionalMetadata)).U()));return[].concat(g.F(new Set(v)))};
g.C(AuN,Z7);AuN.prototype.U=function(){return[]};
g.C(f0N,Z7);
f0N.prototype.U=function(){var v=[];this.Y.musicLibraryStatusEntity&&v.push(this.Y.musicLibraryStatusEntity);this.Y.artists&&v.push.apply(v,g.F(this.Y.artists));this.Y.audioModeVersion&&v.push(this.Y.audioModeVersion);this.Y.videoModeVersion&&v.push(this.Y.videoModeVersion);this.Y.userDetails&&v.push(this.Y.userDetails);this.Y.details&&v.push(this.Y.details);this.Y.albumRelease&&v.push(this.Y.albumRelease);this.Y.share&&v.push(this.Y.share);this.Y.libraryEdit&&v.push(this.Y.libraryEdit);this.Y.downloadMetadata&&
v.push(this.Y.downloadMetadata);this.Y.playbackPosition&&v.push(this.Y.playbackPosition);this.Y.lyrics&&v.push(this.Y.lyrics);return[].concat(g.F(new Set(v)))};
g.C($ZN,Z7);$ZN.prototype.U=function(){var v=[];this.Y.parentTrack&&v.push(this.Y.parentTrack);return[].concat(g.F(new Set(v)))};
g.C(kkJ,Z7);kkJ.prototype.U=function(){var v=[];this.Y.parentTrack&&v.push(this.Y.parentTrack);return[].concat(g.F(new Set(v)))};
g.C(UZ8,Z7);UZ8.prototype.U=function(){return[]};
g.C(cuL,Z7);cuL.prototype.U=function(){return[]};
g.C(uJS,Z7);uJS.prototype.U=function(){return[]};
g.C(CUY,Z7);CUY.prototype.U=function(){return[]};
g.C(yuY,Z7);yuY.prototype.U=function(){var v=[];this.Y.transfer&&v.push(this.Y.transfer);this.Y.adsPlaybackData&&v.push.apply(v,g.F(this.Y.adsPlaybackData));this.Y.drmLicense&&v.push(this.Y.drmLicense);this.Y.offlineVideoPolicy&&v.push(this.Y.offlineVideoPolicy);this.Y.videoDownloadContextEntity&&v.push(this.Y.videoDownloadContextEntity);return[].concat(g.F(new Set(v)))};
g.C(a0J,Z7);a0J.prototype.U=function(){return[]};
g.C(xZv,Z7);xZv.prototype.U=function(){var v=[];this.Y.offlineVideoStreams&&v.push.apply(v,g.F(this.Y.offlineVideoStreams));this.Y.captionTrack&&v.push.apply(v,g.F(this.Y.captionTrack));return[].concat(g.F(new Set(v)))};
g.C(pBL,Z7);pBL.prototype.U=function(){return[]};
g.C(Tdv,Z7);Tdv.prototype.U=function(){return[]};
g.C(l0t,Z7);l0t.prototype.U=function(){return[]};
g.C(Ff8,Z7);Ff8.prototype.U=function(){return[]};
g.C(hvS,Z7);hvS.prototype.U=function(){return[]};
g.C(Rv0,Z7);Rv0.prototype.U=function(){return[]};
g.C(evC,Z7);evC.prototype.U=function(){return[]};
g.C(EXt,Z7);EXt.prototype.U=function(){return[]};
g.C(QsN,Z7);QsN.prototype.U=function(){return[]};
g.C(LfL,Z7);LfL.prototype.U=function(){return[]};
g.C(BdC,Z7);BdC.prototype.U=function(){return[]};
g.C(ZK0,Z7);ZK0.prototype.U=function(){return[]};
g.C(XBJ,Z7);XBJ.prototype.U=function(){return[]};
g.C(wBL,Z7);wBL.prototype.U=function(){return[]};
g.C(I0U,Z7);I0U.prototype.U=function(){return[]};
g.C(q6L,Z7);q6L.prototype.U=function(){return[]};
g.C(nX8,Z7);nX8.prototype.U=function(){return[]};
g.C(JuL,Z7);JuL.prototype.U=function(){return[]};
g.C(KfN,Z7);KfN.prototype.U=function(){return[]};
g.C(PUY,Z7);PUY.prototype.U=function(){return[]};
var KR8=["browse","music/browse","unplugged/browse"],tmN=["offline/playlist_sync_check"],LRY=["offline"],PeN=["offline/offline_video_playback_position_sync"],iBN=["offline/get_playback_data_entity"],XE;wm.getInstance=function(){return g.B(function(v){return v.return(new Promise(function(O){g.Hh().then(function(Y){Y?(wm.instance||(wm.instance=new wm(Y)),O(wm.instance)):O(void 0)})}))})};
wm.prototype.get=function(v){var O=this,Y,S,d;return g.B(function(r){if(r.U==1)return g.E(r,t68(O.token),2);if(r.U!=3)return Y=r.Y,g.E(r,Y.get("prefs",v),3);S=r.Y;if(!S)return r.return();d=(0,g.J)();return S.expirationTimestampMs<=d?r.return():r.return(S.value)})};
wm.prototype.set=function(v,O,Y){Y=Y===void 0?31536E3:Y;var S=this,d,r,b;return g.B(function(z){if(z.U==1)return d=(0,g.J)(),r={key:v,value:O,expirationTimestampMs:d+Y*1E3},g.E(z,t68(S.token),2);b=z.Y;return g.E(z,g.E8(b,"prefs",r),0)})};
wm.prototype.remove=function(v){var O=this,Y;return g.B(function(S){if(S.U==1)return g.E(S,t68(O.token),2);Y=S.Y;return g.E(S,Y.delete("prefs",v),0)})};
g.C(Ie,g.iK);g.C(qT,OZv);qT.prototype.G=function(v,O){O=SWt(O);v=(new TextEncoder).encode(JSON.stringify(v));return this.Y.encrypt(v,O)};
qT.prototype.U=function(v,O){if(!(v instanceof Uint8Array))throw DZ8(1);var Y=new TextDecoder;O=SWt(O);v=this.Y.decrypt(v,O);return JSON.parse(Y.decode(v))};
var ddN={accountLinkStatusEntity:U2N,booleanEntity:zRY,buttonEntity:XBJ,captionTrack:UZ8,channelHandle:jNv,commerceAcquisitionClientPayloadEntity:I0U,commerceCartListEntity:q6L,contextNoteFeedEntityPayload:WGY,continuationTokenEntity:QN8,downloadQualityPickerEntity:yF0,downloadsPageRefreshTokenEntity:x2J,downloadsPageViewConfigurationEntity:JF0,downloadStatusEntity:a$N,dismissState:evC,sfvAudioItemCurrentlyPlayingEntity:Ff8,emojiFountainDataEntity:BdC,emojiCustomizationSetEntity:LfL,fakeChannel:g3U,
fakePlaylist:MgN,fakePlaylistEntryCollection:AF0,fakeVideo:f$S,fakeVideoDescription:$2Y,featuredProductsEntity:H5L,flowStateEntity:kAS,iconBadgeEntity:nX8,interstitialInteractionStateEntity:ugN,likeButtonAnimationEntity:KGC,liveChatPollStateEntity:CNL,liveViewerLeaderboardChatEntryPointStateEntity:Tdv,liveViewerLeaderboardPointsEntity:l0t,liveReactionsDataEntity:ZK0,logoEntity:cF0,macroMarkerEntity:PNU,mainDownloadsLibraryEntity:pdJ,mainDownloadsListEntity:l$U,mainPlaylistDownloadStateEntity:FGL,
mainPlaylistEntity:LGK,mainPlaylistVideoEntity:BcK,mainVideoDownloadStateEntity:hRv,mainVideoEntity:I$J,markersEngagementPanelSyncEntity:GAN,markersVisibilityOverrideEntity:i5t,musicAlbumReleaseDetail:bK0,musicAlbumReleaseDownloadMetadataEntity:OKC,musicAlbumRelease:ruN,musicAlbumReleaseUserDetail:oXt,musicArtistDetail:WfN,musicArtist:js0,musicArtistUserDetail:zvY,musicDownloadsLibraryEntity:Y6Y,musicLibraryEdit:ss8,musicLibraryStatusEntity:gXU,musicPlaylist:V6S,musicPlaylistDownloadMetadataEntity:S6U,
musicShare:AuN,musicTrackDetail:$ZN,musicTrackDownloadMetadataEntity:dZK,musicTrack:f0N,musicTrackUserDetail:kkJ,offlineOrchestrationActionWrapperEntity:cuL,offlineVideoPolicy:uJS,offlineVideoStreams:CUY,offlineabilityEntity:RRS,orchestrationWebSamplingEntity:eR0,pageHeaderEntity:EXt,pdpStateEntity:JuL,pinnedProductEntity:NcN,playbackData:yuY,playerStateEntity:m2N,quantityIncrementerEntity:KfN,refresh:a0J,saveToPlaylistListEntity:hvS,settingEntity:Rv0,stringEntity:sN0,suggestedFeedbackChipStateEntity:tgt,
transfer:xZv,trendingOfferEntity:vXv,videoDownloadContextEntity:pBL,videoOverviewAsyncDataEntity:PUY,videoPlaybackPositionEntity:wBL,votingEntity:QsN,ytMainChannelEntity:qfN,youchatPendingResponseEntity:D20,ytMainDownloadedVideoEntity:E3C,ytMainVideoEntity:n3Y};g.C(iR,OZv);iR.prototype.G=function(v){return v};
iR.prototype.U=function(v){if(v instanceof Uint8Array)throw DZ8(0);return v};
g.C(mi,g.X);mi.prototype.observe=function(v){var O=this;this.observers.push(v);return function(){var Y=O.observers.indexOf(v);Y>=0&&O.observers.splice(Y,1)}};
mi.prototype.U=function(v){k7S(this,v.data)};
mi.prototype.cW=function(){this.channel.close()};
var ydw,uQt=new g.Tq("elementsCommand");var xq=new g.Tq("entityBatchUpdate");var WRL=new g.Tq("downloadStatusEntity");var xMU=new g.Tq("mainPlaylistEntityActionMetadata");var Dw=new g.Tq("mainVideoEntityActionMetadata");var QSL=new g.Tq("musicPlaylistEntityActionMetadata");var bYS=new g.Tq("musicTrackEntityActionMetadata");var Ilv=new g.Tq("localImageEntityActionMetadata");var B9=new g.Tq("playbackDataActionMetadata");var CpN=new g.Tq("transferEntityActionMetadata");var otC=new g.Tq("videoPlaybackPositionEntityActionMetadata");var XtU;new g.Mf;new g.Mf;Jdw.prototype.request=function(v,O,Y){O=O===void 0?{}:O;return this.locks.request(v,O,function(S){return Y(S)})};var Sw=g.Pm.caches,Yq,mdJ;Ow.prototype.open=function(v){return Sw.open(G7U(v))};
Ow.prototype.has=function(v){return Sw.has(G7U(v))};
Ow.prototype.delete=function(v){return Sw.delete(G7U(v))};
Ow.prototype.match=function(v,O){var Y=this,S,d,r,b,z,M;return g.B(function(V){switch(V.U){case 1:return g.E(V,Y.keys(),2);case 2:S=V.Y,d=g.y(S),r=d.next();case 3:if(r.done){V.d8(5);break}b=r.value;return g.E(V,Y.open(b),6);case 6:return z=V.Y,g.E(V,z.match(v,O),7);case 7:if(M=V.Y)return V.return(M);r=d.next();V.d8(3);break;case 5:return V.return()}})};
g.C(Pd0,Ow);Pd0.prototype.keys=function(){var v,O,Y,S,d,r,b,z,M;return g.B(function(V){if(V.U==1)return v=[],O=g.mF("CacheStorage keys"),g.E(V,Sw.keys(),2);Y=V.Y;S=g.y(Y);for(d=S.next();!d.done;d=S.next()){r=d.value;var A=r.indexOf(":");b=A===-1?{rM:r}:{rM:r.substring(0,A),datasyncId:r.substring(A+1)};z=b.rM;M=b.datasyncId;M===O&&v.push(z)}return V.return(v)})};g.C(r9,g.X);r9.prototype.G=function(v){this.api.PW("onOfflineOperationFailure",v.data)};
r9.prototype.B=function(v){this.api.publish("offlinetransferpause",v.data)};
r9.prototype.cW=function(){var v;(v=this.Y)==null||v.close();var O;(O=this.U)==null||O.close()};HZt.prototype.Gm=function(){this.Y&&oc(this)};
HZt.prototype.Hw=function(){this.U&&this.U.resolve();this.G=this.Y=!1;this.j()};var XMY=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var k_Y="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var FRN="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.C(HBJ,Ew);HBJ.prototype.U=function(v){return g9(v)?O7K(this,v):Mp(v)?dAt(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.C(rBS,Ew);rBS.prototype.U=function(v){return Mp(v)?b7N(this,v):jS0(v)?j6L(this,v):V0(v)?WXt(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.u=zXt.prototype;g.u.Vh4=function(v){var O=this,Y,S,d,r;return g.B(function(b){if(!g.G(v.state,128))return b.d8(0);Y=v.state.ib;var z=(S=Y)==null?void 0:S.errorCode,M=(d=Y)==null?void 0:d.Ow;r=z==="net.connect"&&M===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(z==null?0:z.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.E(b,O.nh(O.player.getVideoData().videoId,r),0)})};
g.u.nh=function(v,O){var Y=this;return g.B(function(S){if(S.U==1){if(Y.U)return S.return();Y.U=!0;return O==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(w9(Y,v,!1,!0),S.d8(0)):g.E(S,X1(Y,v),3)}g.pm(v,4);return g.E(S,Y.Y.nh(O),0)})};
g.u.N_=function(v){v.status===2?(v.status!==this.G&&(bO8(this.Y),g.pm(v.videoId,2)),v.TN&&sn8(this.Y,v.videoId,v.TN)):v.status===4?(X1(this,v.videoId),this.nh(v.videoId,v.n7?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):v.status===1&&zdU(this.Y);this.G=v.status;this.api.PW("localmediachange",{videoId:v.videoId,status:v.status})};
g.u.rF=function(){var v=this,O;return g.B(function(Y){if(Y.U==1){if(v.U)return Y.return();v.U=!0;O=v.player.getVideoData().videoId;return g.E(Y,X1(v,O),2)}return g.E(Y,v.Y.rF(),0)})};
g.u.Vf=function(v){switch(v){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.u.V=function(v){return this.api.D().V(v)};g.C($AC,Ew);$AC.prototype.U=function(v){return g9(v)?UAt(this,v):Mp(v)?cBN(this,v):jS0(v)?uHN(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};TkJ.prototype.Y=function(v,O){var Y=v.action.actionMetadata.priority-O.action.actionMetadata.priority;Y===0&&(v.Y<O.Y?Y=-1:v.Y>O.Y&&(Y=1));return Y};g.C(Ic,g.X);Ic.prototype.cW=function(){this.j&&this.j();g.X.prototype.cW.call(this)};
Ic.prototype.createAction=function(v,O){var Y=g.We(v.entityKey).entityType,S=g.a7(16);return new Uw(Y,S,v,O.actionId,O.rootActionId)};
Ic.prototype.Ug=function(v){var O=this,Y,S,d,r,b,z,M,V,A;return g.B(function(f){if(f.U==1){if(O.vW())return f.return();S=(Y=v.offlineOrchestrationActionWrapperEntity)!=null?Y:new Set;d=[];r=g.y(S);for(b=r.next();!b.done;b=r.next())z=b.value,M=g.We(z),V=M.entityId,hXJ(O.Y,V)||d.push(z);return g.E(f,qSJ(O,d),2)}A=f.Y;return g.E(f,IOJ(O,A),0)})};
Ic.prototype.retry=function(){var v=this;return g.B(function(O){return g.E(O,ntY(v),0)})};KX0.prototype.xb=function(v,O){O=O===void 0?!0:O;var Y=this,S,d,r,b,z,M,V,A;return g.B(function(f){switch(f.U){case 1:if(!Y.Y)return f.return();S=[];d=g.HR(Y.Y.U,O);r=[];for(b={Nb:0};b.Nb<d.length;b={Nb:b.Nb},b.Nb++)z=d[b.Nb],M=Y.Y.jg(z,"json3"),V=g.hy(M,{withCredentials:!0,format:"RAW"},3,500).then(function(k){return function(U){U={metadata:g.s3(d[k.Nb]),trackData:U.xhr.responseText};r.push(U)}}(b)).bv(function(k){d9("Caption fetch error",k)}),S.push(V);
return g.E(f,o3w(S),2);case 2:return g.cm(f,3),g.E(f,REY(v,r),5);case 5:g.ai(f,0);break;case 3:A=g.Tc(f),d9("Caption DB transaction error",A),g.UE(f)}})};g.C(qp,g.X);qp.prototype.cW=function(){this.U&&this.U();g.X.prototype.cW.call(this)};
qp.prototype.G=function(v){var O=this,Y,S,d,r,b,z,M,V;return g.B(function(A){S=(Y=v.transfer)!=null?Y:new Set;d=[];r=g.y(S);for(b=r.next();!b.done;b=r.next())z=b.value,M=g.We(z),V=M.entityId,d.push(V);return d.length===0?A.return():g.E(A,i78(O,d),0)})};g.C(NkN,g.X);g.u=NkN.prototype;g.u.cW=function(){this.HW&&this.HW();this.JK.dispose();this.B.dispose();this.g8&&g.OW(this.C.r7,this.g8);this.FO&&g.OW(this.C.r7,this.FO);g.X.prototype.cW.call(this)};
g.u.n41=function(v){var O=this,Y,S,d;return g.B(function(r){switch(r.U){case 1:Y=g.zh(v,"transfer");if(O.Y&&Y===O.Y.key){w9(O.L,O.Z,!0);O.B.stop();r.d8(0);break}return g.E(r,tH(O.U,{mode:"readwrite",vT:!0},function(b){return nk(b,Y,"transfer").then(function(z){if(z&&z.transferState!=="TRANSFER_STATE_COMPLETE"&&z.transferState!=="TRANSFER_STATE_FAILED")return z.transferState="TRANSFER_STATE_PAUSED_BY_USER",PF(b,z,"transfer").then(function(){return z})})}),3);
case 3:S=r.Y;if(!S){r.d8(0);break}if(!v||!O.G){r.d8(5);break}return g.E(r,AD(v,O.G,O.U,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.E(r,K1(O,v),7);case 7:d=r.Y,bBL({videoId:v,py:S,offlineModeType:d}),g.UE(r)}})};
g.u.zm8=function(){var v=this;if(this.Y&&this.Z){w9(this.L,this.Z,!1);var O=this.Y,Y=(O==null?0:O.key)?g.We(O.key).entityId:"";Y&&this.G&&(new Promise(function(S,d){AD(Y,v.G,v.U,"DOWNLOAD_STATE_PAUSED").catch(function(r){d(r)})})).catch(function(S){d9("Download state setting error",S)})}this.B.stop()};
g.u.Jv=function(){this.Y?YsN(this,this.Y):JD(this)};
g.u.Ou=function(v){var O=this;return g.B(function(Y){switch(Y.U){case 1:if(!O.Y){Y.d8(2);break}if(O.Y.transferState==="TRANSFER_STATE_COMPLETE"||O.Y.transferState==="TRANSFER_STATE_FAILED"||!v.transfer||!v.transfer.has(O.Y.key)){Y.d8(3);break}return g.E(Y,HF(O.U,O.Y.key,"transfer"),4);case 4:O.Y=Y.Y;if(O.Y){Y.d8(3);break}return g.E(Y,Ss0(O),3);case 3:if(O.Y)return Y.return();case 2:return g.E(Y,JD(O),0)}})};
g.u.nh=function(v,O){var Y=this,S,d,r,b,z;return g.B(function(M){switch(M.U){case 1:if(!Y.Y){P9(Y,"onTransferFailure: "+v);M.d8(2);break}S=Y.Y;r=((d=S)==null?0:d.key)?g.We(S.key).entityId:"";a:switch(v){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var V=!1;break a;default:V=!0}return V&&gGS(Y)?g.E(M,G0(Y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.E(M,
MiN(Y,v),5);case 5:if(!r||!Y.G){M.d8(2);break}return g.E(M,AD(r,Y.G,Y.U,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.E(M,K1(Y,r),9);case 9:b=M.Y;W9({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:r,py:S,offlineModeType:b});if(!r||!Y.G){M.d8(2);break}return g.E(M,AD(r,Y.G,Y.U,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:n1(Y),z=JD(Y,!0),O&&O(z),g.UE(M)}})};
g.u.rF=function(v){var O=this,Y,S,d,r,b,z,M,V,A,f,k,U;return g.B(function(c){switch(c.U){case 1:if(!O.Y){P9(O,"onMaybeTransferStreamsExpired");c.d8(2);break}return gGS(O)?g.E(c,G0(O,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.E(c,MiN(O,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!O.G){c.d8(2);break}Y=O.Y;d=((S=Y)==null?0:S.key)?g.We(Y.key).entityId:"";if(!d){c.d8(2);break}return g.E(c,AD(d,O.G,O.U,"DOWNLOAD_STATE_FAILED"),2);case 9:return O.Y||P9(O,"onMaybeTransferStreamsExpiredRetryAttempting"),
r=O.Y,z=((b=r)==null?0:b.key)?g.We(r.key).entityId:"",g.E(c,K1(O,z),10);case 10:return M=c.Y,W9({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:z,py:r,offlineModeType:M}),V=gHC(),g.bi(V,B9,{isEnqueuedForExpiredStreamUrlRefetch:!0}),A=g.zh(z,"playbackData"),f={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:A,actionMetadata:V},k=uD(new Uw("playbackData",z,f)),g.E(c,D7(O.U,k,"offlineOrchestrationActionWrapperEntity"),2);case 2:n1(O),U=JD(O,!0),
v&&v(U),g.UE(c)}})};
var $7N={},Viw=($7N.TRANSFER_STATE_TRANSFERRING=1,$7N.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,$7N);g.u=iD.prototype;g.u.v$=function(){return this.Z.promise};
g.u.Rs=function(){if(this.U&&this.L)return this.Z.promise;$Mw(this).then(this.Z.resolve).catch(this.Z.reject);return this.Z.promise};
g.u.Pf=function(v){var O={};return O.playbackData=new HBJ(v,this.Yg,this.Y),O.transfer=new $AC(v,this.Yg),O.videoPlaybackPositionEntity=new rBS(v,this.Yg),O};
g.u.jV=function(){var v=this;return g.B(function(O){return v.U?g.E(O,vGU(v.U),0):O.d8(0)})};
g.u.xA=function(){var v=this,O,Y;return g.B(function(S){if(S.U==1)return v.U||v.L?g.E(S,v.v$(),2):S.return();v.X!==void 0&&(g.Uq(v.X),v.X=void 0);v.B!==void 0&&(g.Uq(v.B),v.B=void 0);(O=v.U)==null||O.dispose();v.U=void 0;(Y=v.L)==null||Y.dispose();v.L=void 0;v.api.PW("onOrchestrationLostLeader");v.Z=new g.Mf;g.UE(S)})};
g.u.isOrchestrationLeader=function(){return this.G.Y};
g.u.zQ=function(){return g.B(function(v){return v.return(!1)})};
g.u.eV=function(v){var O=this.Y;O.api.publish("offlinetransferpause",v);var Y;(Y=O.U)==null||Y.postMessage(v)};
g.u.Jv=function(v){var O,Y;return g.B(function(S){if(S.U==1)return g.E(S,v9(),2);O=S.Y;if(!O)return S.return();Y=g.zh(v,"transfer");return g.E(S,tH(O,{mode:"readwrite",vT:!0},function(d){var r=nk(d,Y,"transfer"),b=nk(d,g.zh(v,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.az.all([r,b]).then(function(z){z=g.y(z);var M=z.next().value;var V=z.next().value;return M&&M.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(M.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",PF(d,M,"transfer").then(function(){W9({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:v,py:M,offlineModeType:V==null?void 0:V.offlineModeType});return g.az.resolve(null)})):g.az.resolve(null)})}),0)})};
g.u.Xv=function(v){v=v===void 0?43200:v;var O=this,Y,S,d,r,b,z,M,V;return g.B(function(A){if(A.U==1)return O.C.hE()?g.E(A,v9(),2):A.return(kfJ());if(A.U!=3){Y=A.Y;if(!Y)return A.return([]);S=Date.now()/1E3;return g.E(A,NT(Y,"offlineVideoPolicy"),3)}d=A.Y;r=[];b=g.y(d);for(z=b.next();!z.done;z=b.next())M=z.value,Number(M.lastUpdatedTimestampSeconds)+v<=S&&(V=g.We(M.key).entityId,r.push(V));return r.length?A.return(md(O,r,O.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):A.return([])})};
g.u.deleteAll=function(){return md(this,["!*$_ALL_ENTITIES_!*$"],this.j,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.u.refreshAllStaleEntities=function(v){var O=this;return g.B(function(Y){return Y.U==1?g.E(Y,O.Xv(v),2):Y.return(Y.Y)})};
g.u.setUpPositionSyncInterval=function(v){var O=this;this.B!==void 0&&(g.Uq(this.B),this.B=void 0);var Y=v!=null?v:864E5;this.B=g.$c(function(){O.jS(Y)},Y)};
g.u.jS=function(v){var O=this,Y,S,d,r,b,z;return g.B(function(M){switch(M.U){case 1:return g.cm(M,2),g.E(M,wm.getInstance(),4);case 4:Y=M.Y;if(!Y)throw Error("prefStorage is undefined");return g.E(M,Y.get("psi"),5);case 5:S=M.Y;r=((d=S)==null?0:d.fO)?Number(S.fO)/1E3:0;b=Date.now();if(!(r+v<=b)){M.d8(6);break}return g.E(M,md(O,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.ai(M,0);break;case 2:z=g.Tc(M),d9("Offline manager error",z),
g.UE(M)}})};
g.u.T1=function(){var v=this,O,Y,S,d,r,b,z;return g.B(function(M){if(M.U==1)return g.E(M,v9(),2);if(M.U!=3)return(O=M.Y)?g.E(M,NT(O,"transfer"),3):M.return([]);Y=M.Y;S=[];d=g.y(Y);for(r=d.next();!r.done;r=d.next())b=r.value,b.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&b.key&&(z=g.We(b.key).entityId,S.push(z));return M.return(cSY(v,S))})};
g.u.Yh=function(){return g.B(function(v){return v.return([])})};
g.u.Tz=function(){return g.B(function(v){g.UE(v)})};
g.u.Bo=function(){return g.B(function(v){g.UE(v)})};g.C(uGw,Ew);uGw.prototype.U=function(v){return g9(v)?alL(this,v):Mp(v)?pIY(this,v):V0(v)?TrJ(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var tD=[10];g.C(edN,Ew);edN.prototype.U=function(v){return g9(v)?Lpv(this,v):Mp(v)?Brt(this,v):V0(v)?ZOK(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var Qnt=[10];g.C(wIK,Ew);wIK.prototype.U=function(v){return Mp(v)?qsU(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};g.C(nGN,iD);g.u=nGN.prototype;g.u.Pf=function(v){var O=iD.prototype.Pf.call(this,v);O.mainVideoEntity=new edN(v,this.Yg,this.Y);O.mainPlaylistEntity=new uGw(v,this.Yg,this.Y);O.mainDownloadsListEntity=new wIK(v,this.Yg,this.Y);return O};
g.u.refreshAllStaleEntities=function(v,O){var Y=this,S,d,r,b,z,M,V,A,f,k,U;return g.B(function(c){switch(c.U){case 1:S=[];if(!Y.Yg.V("web_player_offline_playlist_auto_refresh")){c.d8(2);break}return g.E(c,JSS(Y,v,O),3);case 3:S=c.Y;case 2:return g.E(c,wm.getInstance(),4);case 4:return d=c.Y,g.E(c,(r=d)==null?void 0:r.get("sdois"),5);case 5:return b=c.Y,g.E(c,(z=d)==null?void 0:z.get("lmqf"),6);case 6:M=c.Y;if(!b){c.d8(7);break}A=S;f=A.concat;return g.E(c,KpY(Y,b,(V=M)!=null?V:"SD",v===0),8);case 8:S=
f.call(A,c.Y);case 7:return k=S,U=k.concat,g.E(c,iD.prototype.refreshAllStaleEntities.call(Y,v,O),9);case 9:return S=U.call(k,c.Y),c.return(S)}})};
g.u.zQ=function(v){var O,Y,S,d,r,b,z,M;return g.B(function(V){if(V.U==1)return g.E(V,v9(),2);if(V.U!=3)return(O=V.Y)?g.E(V,HF(O,g.Q1,"mainDownloadsListEntity"),3):V.return(!1);Y=V.Y;if((S=Y)==null?0:(d=S.downloads)==null?0:d.length)for(r=g.zh(v,"mainVideoEntity"),b=g.y(Y.downloads),z=b.next();!z.done;z=b.next())if(M=z.value,M.videoItem===r)return V.return(!0);return V.return(!1)})};
g.u.Yh=function(){var v=this,O,Y,S,d,r,b,z,M;return g.B(function(V){if(V.U==1)return g.E(V,v9(),2);if(V.U!=3)return(O=V.Y)?g.E(V,NT(O,"downloadStatusEntity"),3):V.return([]);Y=V.Y;S=[];d=g.y(Y);for(r=d.next();!r.done;r=d.next())b=r.value,b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&b.key&&(z=g.We(b.key).entityId,S.push(z));return S.length?(M={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},V.return(md(v,S,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
M))):V.return([])})};
g.u.Bo=function(){var v;return g.B(function(O){return O.U==1?g.E(O,v9(),2):(v=O.Y)?g.E(O,tH(v,{mode:"readwrite",vT:!0},function(Y){return JH(Y,"mainVideoEntity").then(function(S){var d=[];S=g.y(S);for(var r=S.next();!r.done;r=S.next()){r=r.value;var b=void 0;(b=r.userState)!=null&&b.playbackPosition||(b=g.We(r.key).entityId,b={key:g.zh(b,"videoPlaybackPositionEntity"),videoId:b,lastPlaybackPositionSeconds:"0"},d.push(PF(Y,b,"videoPlaybackPositionEntity")),r.userState={playbackPosition:b.key},d.push(PF(Y,
r,"mainVideoEntity")))}return g.az.all(d)})}),0):O.return()})};
g.u.Tz=function(){var v,O,Y,S,d,r,b,z,M,V,A,f,k,U,c,a,x,T,l,Q,L,I,t,P,YQ,dF,N,j1,D,yd,pn,Qd,uL,jU,ll,xQ,dS,p;return g.B(function(oi){if(oi.U==1)return g.E(oi,v9(),2);if(oi.U!=3){v=oi.Y;if(!v)return oi.return();O=g.zh("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.E(oi,tH(v,{mode:"readonly",vT:!0},function(P0){return g.az.all([nk(P0,O,"mainDownloadsListEntity"),nk(P0,g.Q1,"mainDownloadsListEntity"),JH(P0,"mainVideoEntity"),JH(P0,"mainPlaylistEntity")])}),3)}Y=oi.Y;
S=g.y(Y);d=S.next().value;r=S.next().value;b=S.next().value;z=S.next().value;M=d;V=r;A=b;f=z;k=new Set;if((U=M)==null?0:(c=U.downloads)==null?0:c.length)for(a=g.y(M.downloads),x=a.next();!x.done;x=a.next())T=x.value,l=void 0,(Q=(l=T.videoItem)!=null?l:T.playlistItem)&&k.add(Q);if((L=V)==null?0:(I=L.downloads)==null?0:I.length)for(t=g.y(V.downloads),P=t.next();!P.done;P=t.next())YQ=P.value,YQ.videoItem&&k.add(YQ.videoItem);dF=new Set;N=[];j1=g.y(f);for(D=j1.next();!D.done;D=j1.next()){yd=D.value;if(yd.videos)for(pn=
g.y(yd.videos),Qd=pn.next();!Qd.done;Qd=pn.next())uL=Qd.value,(jU=JSON.parse(g.We(uL).entityId).videoId)&&dF.add(jU);yd.key&&!k.has(yd.key)&&N.push(yd.key)}ll=g.y(A);for(xQ=ll.next();!xQ.done;xQ=ll.next())dS=xQ.value,dS.key&&!k.has(dS.key)&&(p=g.We(dS.key).entityId,dF.has(p)||N.push(dS.key));return N.length?g.E(oi,xfN(v,N),0):oi.d8(0)})};g.C(PEC,Ew);PEC.prototype.U=function(v){return g9(v)?iOK(this,v):Mp(v)?mMY(this,v):V0(v)?tiN(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var H9=[10];g.C(HOS,Ew);HOS.prototype.U=function(v){return g9(v)?v0K(this,v):Mp(v)?OYv(this,v):V0(v)?YyN(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var Np=[10];g.C(r5L,Ew);r5L.prototype.U=function(v){return g9(v)?WqL(this,v):Mp(v)?z2N(this,v):V0(v)?s$Y(this,v):Promise.reject(Error("Unsupported action type: "+v.actionType))};
var j$L=[10];g.C(v_,iD);v_.prototype.Pf=function(v){var O=iD.prototype.Pf.call(this,v);O.musicTrack=new r5L(v,this.Y);O.musicPlaylist=new HOS(v,this.Y);O.musicAlbumRelease=new PEC(v,this.Y);return O};
v_.prototype.refreshAllStaleEntities=function(v,O){var Y=this,S,d,r;return g.B(function(b){if(b.U==1)return g.E(b,MrN(Y,v,O),2);if(b.U!=3)return d=S=b.Y,r=d.concat,g.E(b,iD.prototype.refreshAllStaleEntities.call(Y,v,O),3);S=r.call(d,b.Y);return b.return(S)})};g.C(VrN,g.gx);g.u=VrN.prototype;g.u.create=function(){var v=this;g.w(this,this.events);if(g.PD(this.Yg))this.Y=new nGN(this.Yg,this.player);else if(g.qB(this.Yg)||g.tt(this.Yg)==="WEB_MUSIC_INTEGRATIONS")this.Y=new v_(this.Yg,this.player);this.events.S(this.player,"onPlaybackStartExternal",function(){v.Oo()});
this.events.S(this.player,"videodatachange",function(){v.Oo()});
this.Yg.V("html5_offline_playback_position_sync")&&this.events.S(this.player,"presentingplayerstatechange",this.YJ)};
g.u.tS=function(){return!1};
g.u.At=function(v,O,Y,S){var d=this;return g.B(function(r){return d.Y?r.return(md(d.Y,v,O,Y,S)):r.return(Promise.reject())})};
g.u.deleteAll=function(){return this.Y.deleteAll()};
g.u.Xv=function(v){return this.Y.Xv(v)};
g.u.refreshAllStaleEntities=function(v){return this.Y.refreshAllStaleEntities(v)};
g.u.setUpPositionSyncInterval=function(v){this.Y.setUpPositionSyncInterval(v)};
g.u.eV=function(v){this.Y.eV(v)};
g.u.Jv=function(v){return this.Y.Jv(v)};
g.u.Oo=function(){var v=this,O;return g.B(function(Y){O=v.player.getVideoData();return g.wX(O)?A5L(O)&&v.U!==O.clientPlaybackNonce?g.E(Y,fr8(v,O),0):Y.d8(0):Y.return()})};
g.u.YJ=function(v){var O=this,Y,S,d,r,b,z,M;return g.B(function(V){if(V.U==1)return Y=O.player.getVideoData(),S=Y.PT,g.UO(v,2)||g.UO(v,512)?g.E(V,v9(),2):V.return();if(V.U!=3){d=V.Y;if(!d)return d9("PES is undefined"),V.return();r=Y.videoId;return g.E(V,HF(d,g.zh(r,"mainVideoEntity"),"mainVideoEntity"),3)}b=V.Y;if(!b)return V.return();z=Math.floor(S).toString();M={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:z}};return g.E(V,O.At([r],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
M),0)})};
g.u.isOrchestrationLeader=function(){return this.Y.isOrchestrationLeader()};
g.u.updateDownloadState=function(v,O){var Y,S,d,r;return g.B(function(b){if(b.U==1)return g.E(b,v9(),2);Y=b.Y;if(!Y)return d9("PES is undefined"),b.return();S=g.We(v);d=S.entityType;r=S.entityId;return g.E(b,AD(r,d,Y,O,!0),0)})};g.se("offline",VrN);})(_yt_player);
